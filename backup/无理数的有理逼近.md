# RATIONAL APPROXIMATIONS OF IRRATIONAL NUMBERS DIMITRIS KOUKOULOPOULOS

## ABSTRACT

Given quantities ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$, a fundamental problem in Diophantine approximation is to understand which irrational numbers $x$ have infinitely many reduced rational approximations $a/q$ such that $\left| {x - a/q}\right| < {\Delta }_{q}$ . Depending on the choice of ${\Delta }_{q}$ and of $x$, this question may be very hard. However, Duffin and Schaeffer conjectured in 1941 that if we assume a "metric" point of view, the question is governed by a simple zero-one law: writing $\varphi$ for Euler’s totient function, we either have $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} = \infty$ and then almost all irrational numbers (in the Lebesgue sense) are approximable, or $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} < \infty$ and almost no irrationals are approximable. We will present the history of the Duffin-Schaeffer conjecture and the main ideas behind the recent work of Koukoulopoulos-Maynard that settled it.

## MATHEMATICS SUBJECT CLASSIFICATION 2020

Primary 11J83; Secondary 05C40

## KEYWORDS

Diophantine approximation, Duffin-Schaeffer conjecture, Metric Number Theory,

compression arguments, density increment, graph theory


## 1. DIOPHANTINE APPROXIMATION

Let $x$ be an irrational number. In many settings, practical and theoretical, it is important to find fractions $a/q$ of small numerator and denominator that approximate it well. This fundamental question lies at the core of the field of Diophantine approximation.

## 1.1. First principles

The "high-school way" of approximating $x$ is to use its decimal expansion. This approach produces fractions $a/{10}^{n}$ such that $\left| {x - a/{10}^{n}}\right| \approx {10}^{-n}$ typically. However, the error can be made much smaller if we allow more general denominators [14, THEOREM 2.1].

Theorem 1.1. If $x \in \mathbb{R} \smallsetminus \mathbb{Q}$, then $\left| {x - a/q}\right| < {q}^{-2}$ for infinitely many pairs $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ .

Dirichlet (c. 1840) gave a short and clever proof of this theorem. However, his argument is nonconstructive because it uses the pigeonhole principle. This gap is filled by the theory of continued fractions (which actually precedes Dirichlet's proof).

Given any $x \in \mathbb{R} \smallsetminus \mathbb{Q}$, we may write $x = {n}_{0} + {r}_{0} \approx {n}_{0}$, where ${n}_{0} = \lfloor x\rfloor$ is the integer part of $x$ and ${r}_{0} = \{ x\}$ is its fractional part. We then let ${n}_{1} = \left\lfloor {1/{r}_{0}}\right\rfloor$ and ${r}_{1} = \left\{ {1/{r}_{0}}\right\}$, so that $x = {n}_{0} + 1/\left( {{n}_{1} + {r}_{1}}\right) \approx {n}_{0} + 1/{n}_{1}$ . If we repeat this process $j - 1$ more times, we find that

$$
x \approx {n}_{0} + \frac{1}{{n}_{1} + \frac{1}{\cdots + \frac{1}{{n}_{j}}}}\;\text{with}\;{n}_{i} = \left\lfloor \frac{1}{{r}_{i - 1}}\right\rfloor ,\;{r}_{i} = \left\{ \frac{1}{{r}_{i - 1}}\right\} \;\text{for}\;i = 1,\ldots, j. \tag{1.1}
$$

If we write this fraction as ${a}_{j}/{q}_{j}$ in reduced form, then a calculation reveals that

$$
{a}_{j} = {n}_{j}{a}_{j - 1} + {a}_{j - 2}\;\left( {j \geq 2}\right) ,\;{a}_{1} = {n}_{0}{n}_{1} + 1,\;{a}_{0} = {n}_{0}, \tag{1.2}
$$

$$
{q}_{j} = {n}_{j}{q}_{j - 1} + {q}_{j - 2}\;\left( {j \geq 2}\right) ,\;{q}_{1} = {n}_{1},\;{q}_{0} = 1.
$$

When $j \rightarrow \infty$, the right-hand side of (1.1), often denoted by $\left\lbrack {{n}_{0};{n}_{1},\ldots ,{n}_{j}}\right\rbrack$, converges to $x$ . The resulting representation of $x$ is called its continued fraction expansion. The quotients ${a}_{j}/{q}_{j}$ are called the convergents of this expansion and they have remarkable properties [17]. We list some of them below, with the first giving a constructive proof of Theorem 1.1.

Theorem 1.2. Assume the above set-up and notations.

(a) For each $j \geq 0$, we have $1/\left( {2{q}_{j}{q}_{j + 1}}\right) \leq \left| {x - {a}_{j}/{q}_{j}}\right| \leq 1/\left( {{q}_{j}{q}_{j + 1}}\right)$ .

(b) For each $j \geq 0$, we have $\left| {x - {a}_{j}/{q}_{j}}\right| = \min \left\{ {\left| {x - a/q}\right| : 1 \leq q \leq {q}_{j}}\right\}$ .

(c) If $\left| {x - a/q}\right| < 1/\left( {2{q}^{2}}\right)$ with a and $q$ coprime, then $a/q = {a}_{j}/{q}_{j}$ for some $j \geq 0$ .

## 1.2. Improving Dirichlet's approximation theorem

It is natural to ask when a qualitative improvement of Theorem 1.1 exists. Inverting this question leads us to the following definition: we say that a real number $x$ is badly approximable if there is $c = c\left( x\right) > 0$ such that $\left| {x - a/q}\right| \geq c{q}^{-2}$ for all $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ .

We can characterize approximable numbers in terms of their continued fraction expansion. Indeed, Theorem 1.2(a) and relation (1.2) imply that $1/4 \leq {n}_{j + 1}{q}_{j}^{2}\left| {x - {a}_{j}/{q}_{j}}\right| \leq 1$ .

Hence, together with Theorem 1.2(c), this implies that $x$ is badly approximable if and only if the sequence ${\left( {n}_{j}\right) }_{j = 0}^{\infty }$ is bounded. Famously, Lagrange proved that the quadratic irrational numbers are in one-to-one correspondence with the continued fractions that are eventually periodic $\left\lbrack {{17},\$ {10}}\right\rbrack$ . In particular, all such numbers are badly approximable.

A related concept to badly approximable numbers is the irrationality measure. For each $x \in \mathbb{R}$, we define it to be

$$
\mu \left( x\right) \mathrel{\text{:=}} \sup \left\{ {v \geq 0 : 0 < \left| {x - a/q}\right| < {q}^{-v}\text{ for infinitely many pairs }\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}}\right\} .
$$

Note that $\mu \left( x\right) = 1$ if $x \in \mathbb{Q}$, whereas $\mu \left( x\right) \geq 2$ if $x \in \mathbb{R} \smallsetminus \mathbb{Q}$ by Theorem 1.1. Moreover, $\mu \left( x\right) = 2$ if $x$ is badly approximable. In particular, $\mu \left( x\right) = 2$ for all quadratic irrationals $x$ . Remarkably, Roth [25] proved that $\mu \left( x\right) = 2$ for all algebraic irrational numbers $x$ .

Determining the irrationality measure of various famous transcendental constants is often very hard. We do know that $\mu \left( e\right) = 2$, where $e$ denotes Euler’s constant. However, determining $\mu \left( \pi \right)$ is a famous open problem. Towards it, Zeilberger and Zudilin [29] proved that $\mu \left( \pi \right) \leq {7.10320533}\ldots$ It is widely believed that $\mu \left( \pi \right) = 2$ .

Instead of trying to reduce the error term in Dirichlet's approximation theorem, we often require a different type of improvement: restricting the denominators $q$ to lie in some special set $\mathcal{S}$ . The theory of continued fractions is of limited use for such problems because the denominators it produces satisfy rigid recursive relations (cf. (1.2)).

For rational approximation with prime or square denominators, the best results at the moment are due to Matomäki [21] and Zaharescu [28], respectively.

Theorem 1.3 (Matomäki (2009)). Let $x$ be an irrational number and let $\varepsilon > 0$ . There are infinitely many integers $a$ and prime numbers $p$ such that $\left| {x - a/p}\right| < {p}^{-4/3 + \varepsilon }$ .

Theorem 1.4 (Zaharescu (1995)). Let $x$ be an irrational number and let $\varepsilon > 0$ . There are infinitely many pairs $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ such that $\left| {x - a/{q}^{2}}\right| < {q}^{-8/3 + \varepsilon }$ .

Two important open problems are to show that Theorems 1.3 and 1.4 remain true even if we replace the constants $4/3$ and $8/3$ by 2 and 3, respectively.

## 2. METRIC DIOPHANTINE APPROXIMATION

Unable to answer simple questions about the rational approximations of specific numbers, a lot of research adopted a more statistical point of view. For example, given $M > 2$ , what proportion of real numbers have irrationality measure $\geq M$ ? This new perspective gives rise to the theory of metric Diophantine approximation, which has a much more analytic and probabilistic flavor than the classical theory of Diophantine approximation. As we will see, the ability to ignore small pathological sets of numbers leads to a much more robust theory that provides simple and satisfactory answers to very general questions.

In order to give precise meaning to the word "proportion," we shall endow $\mathbb{R}$ with a measure. Here, we will mainly use the Lebesgue measure (denoted by "meas").

## 2.1. The theorems of Khinchin and Jarník-Besicovitch

The foundational result in the field of metric Diophantine approximation was proven by Khinchin in his seminal 1924 paper [18]. It is a rather general result: given a sequence ${\Delta }_{1},{\Delta }_{2},\ldots , \geq 0$ of "permissible margins of error," we wish to determine for which real numbers $x$ there are infinitely many pairs $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ such that $\left| {x - a/q}\right| < {\Delta }_{q}$ . Clearly, if $x$ has this property, so does $x + 1$ . Hence, we may focus on studying

$$
\mathcal{A} \mathrel{\text{:=}} \left\{ {x \in \left\lbrack {0,1}\right\rbrack : \left| {x - a/q}\right| < {\Delta }_{q}\text{ for infinitely many pairs }\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}}\right\} . \tag{2.1}
$$

Theorem 2.1 (Khinchin (1924)). Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$ and let $\mathcal{A}$ be defined as in (2.1).

(a) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }q{\Delta }_{q} < \infty$, then $\operatorname{meas}\left( \mathcal{A}\right) = 0$ .

(b) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }q{\Delta }_{q} = \infty$ and the sequence ${\left( {q}^{2}{\Delta }_{q}\right) }_{q = 1}^{\infty }$ is decreasing, then $\operatorname{meas}\left( \mathcal{A}\right) = 1$ .

Corollary 2.2. For almost all $x \in \mathbb{R}$, we have $\left| {x - a/q}\right| \leq 1/\left( {{q}^{2}\log q}\right)$ for infinitely many $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ . On the other hand, if $c > 1$ is fixed, then for almost every $x \in \mathbb{R}$, the inequality $\left| {x - a/q}\right| \leq 1/\left( {{q}^{2}{\log }^{c}q}\right)$ admits only finitely many solutions $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ .

In particular, Corollary 2.2 implies that the set of badly approximable numbers has null Lebesgue measure. On the other hand, it also says that almost all real numbers have irrationality measure equal to 2 . This last result is the main motivation behind the conjecture that $\mu \left( \pi \right) = 2$ : we expect $\pi$ to behave like a "typical" real number.

Naturally, the fact that ${\mathcal{W}}_{M} \mathrel{\text{:=}} \{ x \in \mathbb{R} : \mu \left( x\right) \geq M\}$ has null Lebesgue measure for $M > 2$ raises the question of determining its Hausdorff dimension (denoted by $\dim \left( {\mathcal{W}}_{M}\right)$ ). Jarník [16] and Besicovitch [5] answered this question independently of each other.

Theorem 2.3 (Jarník (1928), Besicovitch (1934)). We have $\dim \left( {\mathcal{W}}_{M}\right) = 2/M$ for all $M \geq 2$ .

## 2.2. Generalizing Khinchin's theorem

Following the publication of Khinchin's theorem, research focused on weakening the assumption that ${q}^{2}{\Delta }_{q} \searrow$ in part (b). Importantly, doing so would open the door to understanding rational approximations using only a restricted set of denominators. Indeed, if ${q}^{2}{\Delta }_{q} \searrow$, then either ${\Delta }_{q} > 0$ for all $q$, or there is ${q}_{0}$ such that ${\Delta }_{q} = 0$ for all $q \geq {q}_{0}$ . The second case is trivial, since it implies $\mathcal{A} = \varnothing$ . So, if we wish to understand Diophantine approximation with a restricted set of denominators $S$ (which would require ${\Delta }_{q} = 0$ for $q \notin S$ ), then we must prove a version of Theorem 2.1(b) without the assumption that ${q}^{2}{\Delta }_{q} \searrow$ .

In order to understand better the forces at play here, it is useful to recast Khinchin's theorem in probabilistic terms. For each $q$, let us define the set

$$
{\mathcal{A}}_{q} \mathrel{\text{:=}} \left\{ {x \in \left\lbrack {0,1}\right\rbrack : \text{ there is }a \in \mathbb{Z}\text{ such that }\left| {x - \frac{a}{q}}\right| < {\Delta }_{q}}\right\}
$$

$$
= \left\lbrack {0,1}\right\rbrack \cap \mathop{\bigcup }\limits_{{0 \leq a \leq q}}\left( {\frac{a}{q} - {\Delta }_{q},\frac{a}{q} + {\Delta }_{q}}\right) . \tag{2.2}
$$

Then $\mathcal{A} = \left\{ {x \in \left\lbrack {0,1}\right\rbrack : x \in {\mathcal{A}}_{q}\text{infinitely often}}\right\}$, which we often write as $\mathcal{A} = \lim \mathop{\sup }\limits_{{q \rightarrow \infty }}{\mathcal{A}}_{q}$ . We may thus view $\mathcal{A}$ as the event that for a number chosen uniformly at random from $\left\lbrack {0,1}\right\rbrack$ , an infinite number of the events ${\mathcal{A}}_{1},{\mathcal{A}}_{2},\ldots$ occur. A classical result from probability theory due to Borel and Cantelli [14, LEMMAS 1.2 & 1.3] studies precisely this kind of questions.

Theorem 2.4. Let $\left( {\Omega ,\mathcal{F},\mathbb{P}}\right)$ be a probability space, let ${E}_{1},{E}_{2},\ldots$ be events in that space, and let $E = \mathop{\limsup }\limits_{{j \rightarrow \infty }}{E}_{j}$ be the event that infinitely many of the ${E}_{j}$ ’s occur.

(a) (The first Borel-Cantelli lemma) If $\mathop{\sum }\limits_{{j = 1}}^{\infty }\mathbb{P}\left( {E}_{j}\right) < \infty$, then $\mathbb{P}\left( E\right) = 0$ .

(b) (The second Borel-Cantelli lemma) If $\mathop{\sum }\limits_{{j = 1}}^{\infty }\mathbb{P}\left( {E}_{j}\right) = \infty$ and the events ${E}_{1},{E}_{2},\ldots$ are mutually independent, then $\mathbb{P}\left( E\right) = 1$ .

Remark. Let $N$ be the random variable that counts how many of the events ${E}_{1},{E}_{2},\ldots$ occur. We have $\mathbb{E}\left\lbrack N\right\rbrack = \mathop{\sum }\limits_{{j = 1}}^{\infty }\mathbb{P}\left( {E}_{j}\right)$ . Hence, Theorem 2.4 says that, under certain assumptions, $N = \infty$ almost surely if, and only if, $\mathbb{E}\left\lbrack N\right\rbrack = \infty$ .

To use the above result in the setup of Khinchin’s theorem, we let $\Omega = \left\lbrack {0,1}\right\rbrack$ and equip it with the Lebesgue measure as its probability measure. The relevant events ${E}_{j}$ are the sets ${\mathcal{A}}_{q}$ . Notice that if ${\Delta }_{q} > 1/\left( {2q}\right)$, then ${\mathcal{A}}_{q} = \left\lbrack {0,1}\right\rbrack$, in which case ${\mathcal{A}}_{q}$ occurs immediately for all $x \in \left\lbrack {0,1}\right\rbrack$ . In order to avoid these trivial events, we will assume from now on that

$$
{\Delta }_{q} \leq 1/\left( {2q}\right) \;\text{ for all }q \geq 1,\;\text{ whence }\operatorname{meas}\left( {\mathcal{A}}_{q}\right) = {2q}{\Delta }_{q}. \tag{2.3}
$$

In particular, we see that part (a) of Khinchin's theorem is a direct consequence of the first Borel-Cantelli lemma. On the other hand, the second Borel-Cantelli lemma relies crucially on the assumption that the events ${E}_{j}$ are independent of each other, something that fails generically for the events ${\mathcal{A}}_{q}$ . However, there are variations of the second Borel-Cantelli lemma, where the assumption of independence can be replaced by weaker quasi-independence conditions on the relevant events (cf. Section 3.1). From this perspective, part (b) of Khinchin's theorem can be seen as saying that the condition that the sequence ${\left( {q}^{2}{\Delta }_{q}\right) }_{q = 1}^{\infty }$ is decreasing guarantees enough approximate independence between the events ${\mathcal{A}}_{q}$ so that the conclusion of the second Borel-Cantelli lemma remains valid.

In 1941, Duffin and Schaeffer published a seminal paper [8] that studied precisely what is the right way to generalize Khinchin's theorem so that the simple zero-one law of Borel-Cantelli holds. Their starting point was the simple observation that certain choices of the quantities ${\Delta }_{q}$ create many dependencies between the sets ${\mathcal{A}}_{q}$, thus rendering many of the denominators $q$ redundant. Indeed, note, for example, that if ${\Delta }_{3} = {\Delta }_{15}$, then ${\mathcal{A}}_{3} \subseteq {\mathcal{A}}_{15}$ because each fraction with denominator 3 can also be written as a fraction with denominator 15. By exploiting this simple idea, Duffin and Schaeffer proved the following result:

Proposition 2.5. There are ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$ such that $\mathop{\sum }\limits_{{q = 1}}^{\infty }q{\Delta }_{q} = \infty$ and yet $\operatorname{meas}\left( \mathcal{A}\right) = 0$ .

Proof. Let ${p}_{1} < {p}_{2} < \cdots$ be the primes in increasing order, let ${q}_{j} = {p}_{1}\cdots {p}_{j}$, and let ${S}_{j} = \left\{ {d{p}_{j} : d \mid {q}_{j - 1}}\right\}$ . We then set ${\Delta }_{q} = {\left( {q}_{j}j{\log }^{2}j\right) }^{-1}$ if $q \in {S}_{j}$ for some $j \geq 2$ ; otherwise, we set ${\Delta }_{q} = 0$ . We claim that this choice satisfies the needed conditions.

Since ${\mathcal{A}}_{q} \subseteq {\mathcal{A}}_{{q}_{j}}$ for all $q \in {\mathcal{S}}_{j}$, we have $\mathcal{A} = \mathop{\limsup }\limits_{{j \rightarrow \infty }}{\mathcal{A}}_{{q}_{j}}$ . In addition, since $\mathop{\sum }\limits_{{j = 1}}^{\infty }{q}_{j}{\Delta }_{{q}_{j}} < \infty$, we have meas(lim $\mathop{\sup }\limits_{{j \rightarrow \infty }}{\mathcal{A}}_{{q}_{j}}$ ) $= 0$ by Theorem 2.1(a). Hence, meas $\left( \mathcal{A}\right) = 0$, as needed. On the other hand, we have that

$$
\mathop{\sum }\limits_{{q \geq 1}}q{\Delta }_{q} = \mathop{\sum }\limits_{{j \geq 2}}\mathop{\sum }\limits_{{d \mid {q}_{j - 1}}}d{p}_{j} \cdot \frac{1}{{q}_{j}j{\log }^{2}j} = \mathop{\sum }\limits_{{j \geq 2}}\frac{1}{j{\log }^{2}j}\mathop{\prod }\limits_{{i \leq j - 1}}\left( {1 + \frac{1}{{p}_{i}}}\right) .
$$

By the Prime Number Theorem [19, THEOREM 8.1], the last product is $\geq c\log j$ for some absolute constant $c > 0$ . Consequently, $\mathop{\sum }\limits_{{q = 1}}^{\infty }q{\Delta }_{q} = \infty$, as claimed.

In order to avoid the above kind of counterexamples to the generalized Khinchin theorem, Duffin and Schaeffer were naturally led to consider a modified setup, where only reduced fractions are used as approximations. They thus defined

$$
{\mathcal{A}}^{ * } \mathrel{\text{:=}} \left\{ {x \in \left\lbrack {0,1}\right\rbrack : \left| {x - a/q}\right| < {\Delta }_{q}\text{ for infinitely many reduced fractions }a/q}\right\} . \tag{2.4}
$$

We may write ${\mathcal{A}}^{ * }$ as the lim sup of the sets

$$
{\mathcal{A}}_{q}^{ * } \mathrel{\text{:=}} \left\lbrack {0,1}\right\rbrack \cap \mathop{\bigcup }\limits_{\substack{{0 \leq a \leq q} \\ {\gcd \left( {a, q}\right) = 1} }}\left( {\frac{a}{q} - {\Delta }_{q},\frac{a}{q} + {\Delta }_{q}}\right) . \tag{2.5}
$$

Assuming that (2.3) holds, we readily find that

$$
\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) = {2\varphi }\left( q\right) {\Delta }_{q}
$$

where

$$
\varphi \left( q\right) \mathrel{\text{:=}} \# \{ 1 \leq a \leq q : \gcd \left( {a, q}\right) = 1\}
$$

is Euler’s totient function. They then conjectured that the sets ${\mathcal{A}}_{q}^{ * }$ have enough mutual quasi-independence so that a simple zero-one law holds, as per the Borel-Cantelli lemmas.

The Duffin-Schaeffer conjecture. Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$ and let ${\mathcal{A}}^{ * }$ be defined as in (2.4).

(a) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} < \infty$, then $\operatorname{meas}\left( {\mathcal{A}}^{ * }\right) = 0$ .

(b) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} = \infty$, then $\operatorname{meas}\left( {\mathcal{A}}^{ * }\right) = 1$ .

Of course, part (a) follows from Theorem 2.4(a); the main difficulty is to prove (b).

The Duffin-Schaeffer conjecture is strikingly simple and general. Nonetheless, it does not answer our original question: what is the correct generalization of Khinchin's theorem, where we may use nonreduced fractions? This gap was filled by Catlin [7].

Catlin’s conjecture. Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$, let ${\Delta }_{q}^{\prime } = \mathop{\sup }\limits_{{m \geq 1}}{\Delta }_{qm}$, and let $\mathcal{A}$ be as in (2.1).

(a) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}^{\prime } < \infty$, then $\operatorname{meas}\left( \mathcal{A}\right) = 0$ .

(b) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}^{\prime } = \infty$, then $\operatorname{meas}\left( \mathcal{A}\right) = 1$ .

As Catlin noticed, his conjecture is a direct corollary of that by Duffin and Schaeffer. Indeed, let us consider the set

${\mathcal{A}}^{\prime } = \left\{ {x \in \left\lbrack {0,1}\right\rbrack : \left| {x - a/q}\right| < {\Delta }_{q}^{\prime }\text{ for infinitely many reduced fractions }a/q}\right\} .$

This is the set ${\mathcal{A}}^{ * }$ with the quantities ${\Delta }_{q}$ replaced by ${\Delta }_{q}^{\prime }$, so we may apply the Duffin-Schaeffer conjecture to it. In addition, it is straightforward to check that

$$
\mathcal{A} \smallsetminus \mathbb{Q} = {\mathcal{A}}^{\prime } \smallsetminus \mathbb{Q} \tag{2.6}
$$

when ${\Delta }_{q} \rightarrow 0$ . This settles Catlin’s conjecture in this case. On the other hand, if ${\Delta }_{q} \nrightarrow 0$ , then $\mathcal{A} = \left\lbrack {0,1}\right\rbrack$ and $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}^{\prime } = \infty$, so that Catlin’s conjecture is trivially true.

Just like in Theorem 2.3 of Jarník and Besicovitch, it would be important to also have information about the Hausdorff dimension of the sets $\mathcal{A}$ and ${\mathcal{A}}^{ * }$ in the case when they have null Lebesgue measure. In light of relation (2.6), it suffices to answer this question for the latter set. Beresnevich and Velani [4] proved the remarkable result that the Duffin-Schaeffer conjecture implies a Hausdorff measure version of itself. This is a consequence of a much more general Mass Transfer Principle that they established, and which allows trans-fering information concerning the Lebesgue measure of certain lim sup sets to the Hausdorff measure of rescaled versions of them. As a corollary, they proved:

Theorem 2.6 (Beresnevich-Velani (2006)). Assume that the Duffin-Schaeffer conjecture is true. Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$ be such that $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} < \infty$ . Then the Hausdorff dimension of the set ${\mathcal{A}}^{ * }$ defined by (2.4) equals the infimum of the set of $s > 0$ such that $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}^{s} < \infty$ .

## 2.3. Progress towards the Duffin-Schaeffer conjecture

Since its introduction in 1941, the Duffin-Schaeffer conjectured has been the subject of intensive research activity, with various special cases proven over the years. This process came to a conclusion recently with the proof of the full conjecture [20].

Theorem 2.7 (Koukoulopoulos–Maynard (2020)). The Duffin–Schaeffer conjecture is true.

We will outline the main ideas of the proof of Theorem 2.7 in Section 3. But first we give an account of the work that preceeded it.

Notation. Given two functions $f, g : X \rightarrow \mathbb{R}$, we write $f\left( x\right) \ll g\left( x\right)$ (or $f\left( x\right) = O\left( {g\left( x\right) }\right)$ ) for all $x \in X$ to mean that there is a constant $C$ such that $\left| {f\left( x\right) }\right| \leq {Cg}\left( x\right)$ for all $x \in Y$ .

In the same paper where they introduced their conjecture, Duffin and Schaeffer proved the first general case of it:

Theorem 2.8 (Duffin-Schaeffer (1941)). The Duffin-Schaeffer conjecture is true for all sequences ${\left( {\Delta }_{q}\right) }_{q = 1}^{\infty }$ such that

$$
\mathop{\limsup }\limits_{{Q \rightarrow \infty }}\frac{\mathop{\sum }\limits_{{q \leq Q}}\varphi \left( q\right) {\Delta }_{q}}{\mathop{\sum }\limits_{{q \leq Q}}q{\Delta }_{q}} > 0. \tag{2.7}
$$

To appreciate this result, we must make a few comments about condition (2.7). Note that its left-hand side is the average value of $\varphi \left( q\right) /q$ over $q \in \left\lbrack {1, Q}\right\rbrack$, where $q$ is weighted by ${w}_{q} \mathrel{\text{:=}} q{\Delta }_{q}$ . In particular, we may restrict our attention to $q$ with ${\Delta }_{q} > 0$ . Now, we know

$$
\frac{\varphi \left( q\right) }{q} = \mathop{\prod }\limits_{{p \mid q}}\left( {1 - \frac{1}{p}}\right)
$$

In particular, $\varphi \left( q\right) /q \leq 1$, and the only way this ratio can become much smaller than 1 is if $q$ is divisible by lots of small primes. To see this, let us begin by observing that $q$ can have at most $\log q/\log 2$ prime factors in total. Therefore,

$$
\mathop{\prod }\limits_{{p \mid q, p > \log q}}\left( {1 - \frac{1}{p}}\right) \geq {\left( 1 - \frac{1}{\log q}\right) }^{\log q/\log 2} \geq \frac{1}{5} \tag{2.8}
$$

for $q$ large enough. In addition, we have

$$
\mathop{\prod }\limits_{\substack{{{\left( \log q\right) }^{0.01} < p \leq \log q} \\ {p \mid q} }}\left( {1 - \frac{1}{p}}\right) \geq \mathop{\prod }\limits_{{{\left( \log q\right) }^{0.01} < p \leq \log q}}\left( {1 - \frac{1}{p}}\right) \geq \frac{1}{200} \tag{2.9}
$$

for $q$ large enough by Mertens’ estimate [19, THEOREM 3.4]. Already the above inequalities show that only the primes $\leq {\left( \log q\right) }^{0.01}$ can affect the size of $\varphi \left( q\right) /q$ . But more is true: $\varphi \left( q\right) /q$ is small only if $q$ is divided by many primes $\leq {\left( \log q\right) }^{0.01}$ . Imagine, for example, that

$$
\# \left\{ {p \mid q : {e}^{j - 1} < p \leq {e}^{j}}\right\} \leq {e}^{j}/{j}^{2} + {1000} \tag{2.10}
$$

for $j = 1,2,\ldots ,1 + \lfloor {0.01}\log \log q\rfloor$ . We would then have

$$
\mathop{\prod }\limits_{\substack{{{e}^{j - 1} < p \leq {e}^{j}} \\ {p \mid q} }}\left( {1 - \frac{1}{p}}\right) \geq {\left( 1 - \frac{1}{{e}^{j}}\right) }^{{e}^{j}/{j}^{2} + {1000}} = \exp \left( {-1/{j}^{2} + O\left( {e}^{-j}\right) }\right) .
$$

Multiplying this over all $j$, we deduce that $\varphi \left( q\right) /q \geq c$ for some $c > 0$ independent of $q$ .

We have thus proven that for (2.7) to fail, the main contribution to the weighted sum $\mathop{\sum }\limits_{{q \leq Q}}{w}_{q}$ with ${w}_{q} = q{\Delta }_{q}$ must come from integers for which (2.10) fails. As a matter of fact,(2.10) must fail for lots of $j$ ’s. This is an extremely rare event if we choose $q$ uniformly at random from $\left\lbrack {1, Q}\right\rbrack$ (or even if we choose it uniformly at random from various "nice" subsets of $\left\lbrack {1, Q}\right\rbrack$, such as the primes, or the values of a monic polynomial with integer coefficients). A simple way to see this is to calculate the average value of the function $\# \left\{ {p \mid q : {e}^{j - 1} < }\right.$ $\left. {p \leq {e}^{j}}\right\}$ with respect to the uniform counting measure on $\left\lbrack {1, Q}\right\rbrack$ . We have

$$
\frac{1}{Q}\mathop{\sum }\limits_{{q \leq Q}}\# \left\{ {p \mid q : {e}^{j - 1} < p \leq {e}^{j}}\right\} = \mathop{\sum }\limits_{{{e}^{j - 1} < p \leq {e}^{j}}}\frac{\# \{ q \leq Q : p \mid q\} }{Q} \leq \mathop{\sum }\limits_{{{e}^{j - 1} < p \leq {e}^{j}}}\frac{1}{p} \ll \frac{1}{j}
$$

by Mertens’ theorem [19, THEOREM 3.4]. This is much smaller than ${e}^{j}/{j}^{2}$, so (2.10) should fail rarely as $j \rightarrow \infty$ . (For instance, we may use Markov’s inequality to see this claim.)

In conclusion, Theorem 2.8 settles the Duffin-Schaeffer conjecture when ${\Delta }_{q}$ is mainly supported on "normal" integers, without too many small prime factors. In particular, it implies a significant improvement of Theorems 1.3 and 1.4 for almost all $x \in \mathbb{R}$ .

Corollary 2.9. For almost all $x \in \mathbb{R}$, there are infinitely many reduced fractions $a/p$ and $b/{q}^{2}$ such that $p$ is prime, $\left| {x - a/p}\right| < {p}^{-2}$ and $\left| {x - b/{q}^{2}}\right| < {q}^{-3}$ .

The next important step towards the Duffin-Schaeffer conjecture is a remarkable zero-one law due to Gallagher [12].

Theorem 2.10 (Gallagher (1961)). If ${\mathcal{A}}^{ * }$ is as in (2.4), then meas $\left( {\mathcal{A}}^{ * }\right) \in \{ 0,1\}$ .

Gallagher’s theorem says grosso modo that either we chose the quantities ${\Delta }_{q}$ to be "too small" and thus missed almost all real numbers, or we chose them "sufficiently large" so that almost all numbers have the desired rational approximations. The Duffin-Schaeffer conjecture is then the simplest possible criterion to decide in which case we are.

The proof of Theorem 2.10 is a clever adaptation of an ergodic-theoretic argument due to Cassels [6] in the simpler setting of nonreduced rational approximations. We give Cassel’s proof and refer the interested readers to $\left\lbrack {{12},{14}}\right\rbrack$ for the proof of Theorem 2.10.

Theorem 2.11 (Cassels (1950)). If $\mathcal{A}$ is as in (2.1), then $\operatorname{meas}\left( \mathcal{A}\right) \in \{ 0,1\}$ .

Proof. We need the following fact [14, LEMMA 2.1] that uses Lebesgue's Density Theorem: Let ${I}_{1},{I}_{2},\ldots ,{J}_{1},{J}_{2},\ldots$ be intervals of lengths tending to 0, and let $c > 0$ . For all $k$, suppose ${J}_{k} \subseteq {I}_{k}$ and $\operatorname{meas}\left( {J}_{k}\right) \geq c\operatorname{meas}\left( {I}_{k}\right)$ . Then meas(lim $\mathop{\sup }\limits_{{k \rightarrow \infty }}{I}_{k} \smallsetminus \mathop{\limsup }\limits_{{k \rightarrow \infty }}{J}_{k}$ ) $= 0$ .

Now, for each $r \geq 1$, let ${\mathcal{A}}^{\left( r\right) }$ be defined as in (2.1) but with ${\Delta }_{q}/r$ in place of ${\Delta }_{q}$ . Hence, meas $\left( {\mathcal{A} \smallsetminus {\mathcal{A}}^{\left( r\right) }}\right) = 0$ by the above fact. Therefore, if ${\mathcal{A}}^{\left( \infty \right) } \mathrel{\text{:=}} \mathop{\bigcap }\limits_{{n = 1}}^{\infty }{\mathcal{A}}^{\left( n\right) }$, then $\operatorname{meas}\left( {\mathcal{A} \smallsetminus {\mathcal{A}}^{\left( \infty \right) }}\right) = 0$ . Now, consider the map $\psi : \left\lbrack {0,1}\right\rbrack \rightarrow \left\lbrack {0,1}\right\rbrack$ defined by $\psi \left( x\right) \mathrel{\text{:=}} \{ {2x}\}$ , and note that $\psi \left( {\mathcal{A}}^{\left( \infty \right) }\right) \subseteq {\mathcal{A}}^{\left( \infty \right) }$ . In particular, $\frac{1}{N}\mathop{\sum }\limits_{{n = 0}}^{{N - 1}}{1}_{{\mathcal{A}}^{\left( \infty \right) }}\left( {{\psi }^{n}\left( x\right) }\right) = 1$ for all $x \in {\mathcal{A}}^{\left( \infty \right) }$ and all $N \in \mathbb{N}$ . Since $\psi$ is ergodic with respect to the Lebesgue measure [26, P. 293 & 305-6], Birkhoff’s Ergodic Theorem [26, cH. 6, cor. 5.6] implies that meas $\left( {\mathcal{A}}^{\left( \infty \right) }\right) \in \{ 0,1\}$ .

The first significant step towards establishing the Duffin-Schaeffer conjecture for irregular sequences ${\Delta }_{q}$, potentially supported on integers with lots of small prime factors, was carried out by Erdős [10] and Vaaler [27].

Theorem 2.12 (Erdős (1970), Vaaler (1978)). The Duffin-Schaeffer conjecture is true for all sequences ${\left( {\Delta }_{q}\right) }_{q = 1}^{\infty }$ such that ${\Delta }_{q} = O\left( {1/{q}^{2}}\right)$ for all $q$ .

This theorem is, of course, most interesting when $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} = \infty$ . Since ${\Delta }_{q} = O\left( {1/{q}^{2}}\right)$ and $\varphi \left( q\right) \leq q$, we find $\mathop{\sum }\limits_{{q \in S}}1/q = \infty$ with $s = \left\{ {q : {\Delta }_{q} > 0}\right\}$ . In particular, $S$ must be somewhat dense in $\mathbb{N}$ . Therefore, Theorem 2.12 has the advantage over Theorem 2.8 that $S$ can contain many irregular integers, and the disadvantage that it has to be quite dense.

The Duffin-Schaeffer conjecture has a natural analogue in ${\mathbb{R}}^{k}$ with $k \geq 2$ : given ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$, let ${\mathcal{A}}^{ * }\left( k\right)$ be the set of $\overrightarrow{x} = \left( {{x}_{1},\ldots ,{x}_{k}}\right) \in {\mathbb{R}}^{k}$ for which there are infinitely many $k$ -tuples $\left( {{a}_{1}/q,\ldots ,{a}_{k}/q}\right)$ of reduced fractions with $\left| {{x}_{j} - {a}_{j}/q}\right| < {\Delta }_{q}$ for all $j$ . Then ${\mathcal{A}}^{ * }\left( k\right)$ should contain almost no or almost all $\overrightarrow{x} \in {\mathbb{R}}^{k}$, according to whether the series $\mathop{\sum }\limits_{{q = 1}}^{\infty }{\left( \varphi \left( q\right) {\Delta }_{q}\right) }^{k}$ converges or diverges. This was proven by Pollington and Vaughan [22].

Theorem 2.13 (Pollington–Vaughan (1990)). The $k$ -dimensional Duffin–Schaeffer conjecture is true for all $k \geq 2$ .

Following this result, a lot of research focused on proving the Duffin-Schaeffer conjecture when the series $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}$ diverges fast enough (see, e.g.,[14, THEOREM 3.7(III)], [3, 15]). Aistleitner, Lachmann, Munsch, Technau, and Zafeiropoulos [2] proved the Duffin-

Schaeffer conjecture when $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}/{\left( \log q\right) }^{\varepsilon } = \infty$ for some $\varepsilon > 0$ . A report by Aistleit-ner [1], announced at the same time as [20], explains how to replace ${\left( \log q\right) }^{\varepsilon }$ by ${\left( \log \log q\right) }^{\varepsilon }$ .

## 3. THE MAIN INGREDIENTS OF THE PROOF OF THE DUFFIN-SCHAEFFER CONJECTURE

## 3.1. Borel-Cantelli without independence

Recall the definition of the sets ${\mathcal{A}}_{q}^{ * }$ in (2.5). Let us assume that ${\Delta }_{q} \leq 1/\left( {2q}\right)$ for all $q$ (cf. (2.3)) so that meas $\left( {\mathcal{A}}_{q}^{ * }\right) = {2\varphi }\left( q\right) {\Delta }_{q} \in \left\lbrack {0,1}\right\rbrack$, and let us also suppose that $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} = \infty$ . The first technical difficulty we must deal with is how to prove an analogue of the second Borel-Cantelli lemma (cf. Theorem 2.4(b)) without assuming that the events ${\mathcal{A}}_{q}^{ * }$ are independent. We follow an idea due to Turan, which is already present in [8].

By Gallagher’s zero-one law, it is enough to show that $\operatorname{meas}\left( {\mathcal{A}}^{ * }\right) > 0$ . Since $\mathop{\bigcup }\limits_{{q \geq Q}}{\mathcal{A}}_{q}^{ * } \searrow {\mathcal{A}}^{ * }$, we may equivalently prove that there is some constant $c > 0$ such that meas $\left( {\mathop{\bigcup }\limits_{{q \geq Q}}{\mathcal{A}}_{q}^{ * }}\right) \geq c$ for all large $Q$ . In order to limit the potential overlap among the sets ${\mathcal{A}}_{q}^{ * }$, we only consider an appropriate subset of them. Since meas $\left( {\mathcal{A}}_{q}^{ * }\right) = {2\varphi }\left( q\right) {\Delta }_{q} \in \left\lbrack {0,1}\right\rbrack$ for all $q$, and since $\mathop{\sum }\limits_{{q \geq Q}}\varphi \left( q\right) {\Delta }_{q} = \infty$, there must exist some $R \geq Q$ such that

$$
1 \leq \mathop{\sum }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) \leq 2 \tag{3.1}
$$

We will only use the events ${\mathcal{A}}_{q}^{ * }$ with $q \in \left\lbrack {Q, R}\right\rbrack$ . We trivially have the union bound

$$
\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}{\mathcal{A}}_{q}^{ * }}\right) \leq \mathop{\sum }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) \leq 2.
$$

If we can show that the sets ${\mathcal{A}}_{q}^{ * }$ with $q \in \left\lbrack {Q, R}\right\rbrack$ do not overlap too much, so that

$$
\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}{\mathcal{A}}_{q}^{ * }}\right) \geq c\mathop{\sum }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) \geq c, \tag{3.2}
$$

we will be able to deduce that $\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}{\mathcal{A}}_{q}^{ * }}\right) \geq c$ and a fortiori that meas $\left( {\mathop{\bigcup }\limits_{{q \geq Q}}{\mathcal{A}}_{q}^{ * }}\right) \geq c$ . As the following lemma shows,(3.2) is true under (3.1) as long as we can control the correlations of the events ${\mathcal{A}}_{q}^{ * }$ on average.

Lemma 3.1. Let ${E}_{1},\ldots ,{E}_{k}$ be events in the probability space $\left( {\Omega ,\mathcal{F},\mathbb{P}}\right)$ . We then have

that

$$
\mathbb{P}\left( {\mathop{\bigcup }\limits_{{j = 1}}^{k}{E}_{j}}\right) \geq \frac{{\left( \mathop{\sum }\limits_{{j = 1}}^{k}\mathbb{P}\left( {E}_{j}\right) \right) }^{2}}{\mathop{\sum }\limits_{{i, j = 1}}^{k}\mathbb{P}\left( {{E}_{i} \cap {E}_{j}}\right) }.
$$

Proof. Let $N = \mathop{\sum }\limits_{j}{1}_{{E}_{j}}$ . We then have $\mathbb{E}\left\lbrack N\right\rbrack = \mathop{\sum }\limits_{j}\mathbb{P}\left( {E}_{j}\right)$ . On the other hand, the Cauchy-Schwarz inequality implies that

$$
\mathbb{E}{\left\lbrack N\right\rbrack }^{2} = \mathbb{E}{\left\lbrack {1}_{N > 0} \cdot N\right\rbrack }^{2} \leq \mathbb{P}\left( {\operatorname{supp}\left( N\right) }\right) \cdot \mathbb{E}\left\lbrack {N}^{2}\right\rbrack .
$$

Since $\operatorname{supp}\left( N\right) = \mathop{\bigcup }\limits_{j}{E}_{j}$ and ${N}^{2} = \mathop{\sum }\limits_{{i, j}}{1}_{{E}_{i} \cap {E}_{j}}$, the lemma follows.

Proposition 3.2. Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$, and let ${\mathcal{A}}_{q}^{ * }$ be as in (2.5).

(a) If $C > 0$ and $R \geq Q \geq 1$ are such that

$$
1 \leq \mathop{\sum }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) \leq 2\;\text{ and }\;\mathop{\sum }\limits_{{Q \leq q < r \leq R}}\operatorname{meas}\left( {{\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * }}\right) \leq C, \tag{3.3}
$$

then $\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}{\mathcal{A}}_{q}^{ * }}\right) \geq 1/\left( {2 + {2C}}\right)$ .

(b) If there are infinitely many disjoint intervals $\left\lbrack {Q, R}\right\rbrack$ satisfying (3.3) with the same constant $C > 0$, then meas( $\lim \mathop{\sup }\limits_{{q \rightarrow \infty }}{\mathcal{A}}_{q}^{ * }$ ) $= 1$ .

## 3.2. A bound on the pairwise correlations

As per Proposition 3.2, we need to control the correlations of the events ${\mathcal{A}}_{q}^{ * }$ . To this end, we have a lemma of Pollington-Vaughan [22] (see also [10,27]).

Lemma 3.3. Let $q, r$ be two distinct integers $\geq 2$, let ${\Delta }_{q},{\Delta }_{r} \geq 0$, let ${\mathcal{A}}_{q}^{ * },{\mathcal{A}}_{r}^{ * }$ be as in (2.5), and let $M\left( {q, r}\right) = 2\max \left\{ {{\Delta }_{q},{\Delta }_{r}}\right\} \operatorname{lcm}\left\lbrack {q, r}\right\rbrack$ . If $M\left( {q, r}\right) \leq 1$, then ${\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * } = \varnothing$ . Otherwise,

$$
\operatorname{meas}\left( {{\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * }}\right) \ll \varphi \left( q\right) {\Delta }_{q} \cdot \varphi \left( r\right) {\Delta }_{r} \cdot \exp \left( {\mathop{\sum }\limits_{\substack{{p \mid {qr}/\gcd \left( {q, r}\right) } \\ {p > M\left( {q, r}\right) } }}\frac{1}{p}}\right) .
$$

Proof. Let $\Delta = \max \left\{ {{\Delta }_{q},{\Delta }_{r}}\right\} ,\delta = \min \left\{ {{\Delta }_{q},{\Delta }_{r}}\right\}$ and $M = M\left( {q, r}\right)$ . The intervals ${I}_{a} = \left( {\frac{a}{q} - {\Delta }_{q},\frac{a}{q} + {\Delta }_{q}}\right)$ and ${J}_{b} = \left( {\frac{b}{r} - {\Delta }_{r},\frac{b}{r} + {\Delta }_{r}}\right)$ intersect only if ${2\Delta } > \left| {\frac{a}{q} - \frac{b}{r}}\right|$ . Since the right-hand side is $\geq 1/\operatorname{lcm}\left\lbrack {q, r}\right\rbrack$ when $\gcd \left( {a, q}\right) = \gcd \left( {b, r}\right) = 1$, we infer that ${\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * } = \varnothing$ if $M \leq 1$ .

Now, assume that $M > 1$ . Since meas $\left( {{I}_{a} \cap {J}_{b}}\right) \leq {2\delta }$ for all $a, b$, we have

$$
\operatorname{meas}\left( {{\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * }}\right) \leq {2\delta } \cdot \# \left\{ {\begin{array}{ll} 1 \leq a \leq q, & \gcd \left( {a, q}\right) = 1 \\ 1 \leq b \leq r, & \gcd \left( {b, r}\right) = 1 \end{array} : \left| {\frac{a}{q} - \frac{b}{r}}\right| < {2\Delta }}\right\} .
$$

Let $a/q - b/r = m/\operatorname{lcm}\left\lbrack {q, r}\right\rbrack$ . Then $1 \leq \left| m\right| \leq M$ and $\gcd \left( {m,{q}_{1}{r}_{1}}\right) = 1$, where ${q}_{1} = q/d$ and ${r}_{1} = r/d$ with $d = \gcd \left( {q, r}\right)$ . For each such $m$, a straightforward application of the Chinese Remainder Theorem gives that the number of admissible pairs $\left( {a, b}\right)$ is

$$
\leq d\mathop{\prod }\limits_{{p \mid \gcd \left( {d,{q}_{1}{r}_{1}m}\right) }}\left( {1 - \frac{1}{p}}\right) \mathop{\prod }\limits_{{p \mid d, p \nmid {q}_{1}{r}_{1}m}}\left( {1 - \frac{2}{p}}\right) \leq d\frac{\mathop{\prod }\limits_{{p \mid d}}{\left( 1 - \frac{1}{p}\right) }^{2}}{\mathop{\prod }\limits_{{p \mid \gcd \left( {d,{q}_{1}{r}_{1}}\right) }}\left( {1 - \frac{1}{p}}\right) } \cdot \frac{\left| m\right| }{\varphi \left( \left| m\right| \right) },
$$

where we used that $1 - 2/p \leq {\left( 1 - 1/p\right) }^{2}$ . We then sum this inequality over $m$ and use Lemma 3.4 below to complete the proof. (For full details, see [22] or [14, LEMMA 2.8].)

Lemma 3.4. Fix $C \geq 1$, and let ${\left( {a}_{p}\right) }_{p\text{ prime }}$ be a sequence taking values in $\left\lbrack {0, C}\right\rbrack$ . Then

$$
\mathop{\sum }\limits_{{n \leq x}}\mathop{\prod }\limits_{{p \mid n}}{a}_{p}{ \ll }_{C}x\exp \left( {\mathop{\sum }\limits_{{p \leq x}}\frac{{a}_{p} - 1}{p}}\right) \text{ for all }x \geq 1.
$$

Proof. See Theorem 14.2 in [19].

