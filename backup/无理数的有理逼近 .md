# 第1卷 国际数学家大会

- 前言 ........................................................... v
- 国际数学家大会 ................................................... 1
- 菲尔兹奖获得者和国际数学联盟奖获得者 ....................................... 3
- 国际数学联盟主席的开幕致辞 ............................................... 5
- 国际数学联盟主席的闭幕词 ................................................. 9
- 国际数学联盟的现状报告 ............................................... 11
- 照片 .................................................................... 21
- 菲尔兹奖获得者和国际数学联盟奖获得者的工作
  - Martin Hairer, Hugo Duminil-Copin的工作 ................................... 26
  - Gil Kalai, June Huh的工作 ................................................. 50
  - Kannan Soundararajan, James Maynard的工作 ................................ 66
  - Henry Cohn, Maryna Viazovska的工作 ....................................... 82
  - Ran Raz, Mark Braverman的工作 ............................................ 106
  - Henri Darmon, Barry Mazur的工作 ......................................... 118
  - Rupert L. Frank, Elliott Lieb的工作 ....................................... 142
  - Tadashi Tokieda, Nikolai Andreev以及数学动画和模型建构的艺术 ... 160
- 获奖者演讲
  - Hugo Duminil-Copin, 超立方体晶格上(Ising模型的)100年 .................................. 164
  - June Huh, 组合学和Hodge理论 ............................................ 212
  - James Maynard, 计数质数 .................................................... 240
  - Maryna Viazovska, 欧几里得空间中的离散傅里叶唯一性集 ...................... 270
  - Mark Braverman, 通信和信息复杂性 ........................................ 284
  - Nikolai Andreev, 数学普及：俄罗斯项目和传统的概述 ......................... 322
  - Marie-France Vignéras, p-adic群在交换环上的表示 ........................... 332
- 通俗科学论述
  - Andrei Okounkov, 我们维度和时代的伊辛模型 ................................. 376
  - Andrei Okounkov, 组合几何领先 ............................................ 414
  - Andrei Okounkov, 质数中的韵律 ............................................ 460
  - Andrei Okounkov, 8和24的魔力 ............................................ 492
- 获奖者工作摘要
  - Allyn Jackson, 2022年算盘奖：Mark Braverman ................................ 548
  - Allyn Jackson, 2022年陈省身奖：Barry Mazur ................................ 554
  - Allyn Jackson, 2022年高斯奖：Elliott H. Lieb .............................. 560
  - Allyn Jackson, 2022年利瓦提奖：Nikolai Andreev ........................... 566
- 贡献者名单 ................................................................ 571

# 第2卷 全体讲座

- 特别全体讲座
  - Kevin Buzzard, 计算机的意义何在？纯数学家的问题 ........................... 578
  - Frank Calegari, 自费马最后定理以来的朗兰兹计划中的互反性 .............. 610
  - Frans Pretorius, 引力波综述 ................................................ 652
- 全体讲座
  - Mladen Bestvina, 在双曲空间上作用的群——综述 ................................ 678
  - Bhargav Bhatt, 混合特征的代数几何 ............................................ 712
  - Thierry Bodineau, Isabelle Gallagher, Laure Saint-Raymond, Sergio Simonella, 稀薄气体动力学：统计方法 ............................................................ 750
  - Alexander Braverman, David Kazhdan, 在局部域上曲线上的丛模空间上的自守函数：综述 ............................................................ 796
  - Tobias Holck Colding, 形态和形状的演化 ........................................ 826
  - Camillo De Lellis, 测地线理论中的正则性理论（在几何测度理论中） ..................................... 872
  - Weinan E, 机器学习的数学视角 ................................................ 914
  - Craig Gentry, 同态加密：数学综述 .............................................. 956
  - Alice Guionnet, 随机场理论中的稀有事件 ........................................ 1008
  - Larry Guth, 傅里叶分析中的解耦估计 ............................................ 1054
  - Svetlana Jitomirskaya, 一维准周期算子：全局理论、对偶性以及小分母的精确分析 ............................................................ 1090
  - Igor Krichever, 阿贝尔极系统和黎曼-肖特基型问题 ................................ 1122
  - Alexander Kuznetsov, 家族中的半正交分解 ........................................ 1154
  - Scott Sheffield, 随机曲面是什么？ ................................................ 1202
  - Kannan Soundararajan, 泽塔函数和L函数的值分布 ................................. 1260
  - Catharina Stroppel, 分类：结的不变量和TQFTs .................................... 1312
  - Michel Van den Bergh, 非交换性蜕化解，概述 .................................... 1354
  - Avi Wigderson, 计算复杂性理论与数学的相互作用 ................................ 1392
- 贡献者名单 ................................................................ 1433

# 第3卷 逻辑-代数-数论-复几何

## 1.逻辑学

- Gal Binyamini, Dmitry Novikov, 几何与算术中的温和性：超越o-最小性 ........... 1440
- Natasha Dobrinen, 均匀结构的拉姆齐理论：当前趋势和开放问题 ....................... 1462
- Andrew S. Marks, 可测图组合学 .................................................... 1488
- Keita Yokoyama, 巴黎-哈林顿原理与二阶算术——连接有限与无限拉姆齐定理 ............................................................ 1504
- Dmitriy Zhuk, 约束满足问题：是什么让问题变得简单 ................................... 1530

## 2.代数学

- Pierre-Emmanuel Caprace, George A. Willis, 一个完全断裂的邀请到局部紧群 .................................... 1554
- Neena Gupta, 仿射代数几何中的Zariski消去问题及相关问题 .............................. 1578
- Syu Kato, 半无限标志流形的形式模型 ............................................ 1600
- Michael J. Larsen, 有限单群的特征估计及应用 .................................... 1624
- Amnon Neeman, 有限逼近作为研究三角范畴的工具 ................................ 1636
- Irena Peeva, 多项式环上的Syzygies .................................................... 1660

## 3.数论 

- Joseph H. Silverman, 算术动力学的综述讲座 ........................................ 1682

- Raphaël Beuzart-Plessis, 相对迹公式和Gan-Gross-Prasad猜想 ................................. 1712
- Ana Caraiani, 带有挠率系数的Shimura多样性的上同调 ................................ 1744
- Samit Dasgupta, Mahesh Kakde, 关于Brumer-Stark猜想及其改进 ....................... 1768
- Alexander Gamburd, Markoff型多样性上的算术与动力学 ................................ 1800
- Philipp Habegger, 至少有两个属的曲线上的有理点数 ................................ 1838
- Atsushi Ichino, Theta提升和Langlands协变性 ........................................ 1870
- Dimitris Koukoulopoulos, 无理数的有理逼近 ............................................ 1894
- David Loeffler, Sarah Livia Zerbes, 自动Galois表示的Euler系统和Bloch-Kato猜想 ............................................................ 1918
- Lillian B. Pierce, 计数问题：类群、质数和数域 .................................... 1940
- Sug Woo Shin, Shimura多样性模质数的点 ............................................ 1966
- Ye Tian, 相合数问题和椭圆曲线 .................................................... 1990
- Xinwen Zhu, 算术与几何Langlands程序 ............................................ 2012

## 4.代数和复几何 

- Marc Levine, 动机上同调 ............................................................ 2048

- Mina Aganagic, 来自镜像对称的同调结不变量 ........................................ 2108
- Aravind Asok, Jean Fasel, 代数多样性上的向量丛 ........................................ 2146
- Arend Bayer, Emanuele Macrì, 代数几何中墙壁交叉的不合理有效性 ............................................................ 2172
- Vincent Delecroix, Élise Goujard, Peter Zograf, Anton Zorich, 二次微分的模空间中的格点计数 ............................................................ 2196
- Alexander I. Efimov, 大范畴的K-理论 .................................................... 2212
- Tamás Hausel, 增强的镜像对称性对Langlands对偶Hitchin系统 ................................ 2228
- Bruno Klingler, 介于代数性和超越性之间的Hodge理论 ................................ 2250
- Chi Li, 代数多样性的典范Kähler度量和稳定性 ................................... 2286
- Aaron Pixton, 双拉姆齐循环公式 ........................................................ 2312
- Yuri Prokhorov, 三维最小模型程序中的有效结果 .................................... 2324
- Olivier Wittenberg, 有理点和有理曲线的一些方面 .................................... 2346
- 贡献者名单 ................................................................ 2369

# 第4卷 几何-拓扑-李理论-分析

## 5.几何 

- Bruce Kleiner, 自Perelman以来3D Ric流的发展 ................................... 2376
- Richard Evan Schwartz, 关于台球的综述讲座 ........................................ 2392

- Richard H. Bamler, Ric流近期发展 ................................................. 2432
- Robert J. Berman, 突现的复几何 .................................................... 2456
- Danny Calegari, 香肠 ................................................................ 2484
- Kai Cieliebak, 拉格朗日乘数函数及其在辛几何和弦拓扑中的应用 ............... 2504
- Penka Georgieva, 真实的Gromov-Witten理论 .......................................... 2530
- Hiroshi Iritani, Gamma类和量子上同调 ............................................ 2552
- Gang Liu, 曲率有下界的Kähler流形 ................................................. 2576
- Kathryn Mann, 在无穷远处作用的群 ................................................. 2594
- Mark McLean, Floer上同调、奇点和双有理几何 .................................... 2616
- Iskander A. Taimanov, 通过旋量和孤子方程的曲面 ................................ 2638
- Lu Wang, 平均曲率流中的熵 ........................................................ 2656
- Robert J. Young, 曲面和函数的组合与分解 ........................................ 2678
- Xin Zhou, 均值曲率和变分理论 .................................................... 2696
- Xiaohua Zhu, Fano流形上的Kähler-Ric流 ............................................ 2718

## 6.拓扑学

- Jennifer Hom, 同调包络、结一致性、Heegaard Floer同调 ............................. 2740
- Daniel C. Isaksen, Guozhen Wang, Zhouli Xu, 球面的稳定同伦群和动机同伦理论 ............................................................ 2768
- Yi Liu, 曲面自同构和有限覆盖 .................................................... 2792
- Roman Mikhailov, 群论中的同伦模式 ............................................ 2806
- Thomas Nikolaus, 高阶代数中的Frobenius同态 .................................... 2826
- Oscar Randal-Williams, 圆盘的微分同胚 ........................................ 2856
- Jacob Rasmussen, 带有环面的3-流形的Floer同调 ................................ 2880
- Nathalie Wahl, 同调稳定性：计算工具 ............................................ 2904

## 7.李理论与推广

- Evgeny Feigin, PBW退化解、秩草曼尼恩、和射影簇 ................................ 2930
- Tasho Kaletha, 局部域上的可约群表示 ............................................ 2948
- Joel Kamnitzer, 表示论中的完美基：三座山和它们的源泉 .............................. 2976
- Yiannis Sakellaridis, 球面多样性、协变性和量子化 ................................ 2998
- Peng Shan, 分类和应用 ............................................................ 3038
- Binyong Sun, Chen-Bo Zhu, Theta对应和轨道方法 ................................ 3062
- Weiqiang Wang, 量子对称对 ........................................................ 3080

## 8.分析 

- Keith Ball, 凸几何及其与调和分析、泛函分析和概率论的联系 ..................... 3104

- Benoît Collins, 紧致群上的时刻方法：Weingarten微积分及其应用 ..................... 3142
- Mikael de la Salle, 简单Lie群和格上的分析 ........................................ 3166
- Xiumin Du, 加权傅里叶扩展估计及其应用 ........................................... 3190
- Cyril Houdayer, 高阶格上的非交换遍历理论 ........................................ 3202
- Malabika Pramanik, 稀疏集的一些性质：综述 .................................... 3224
- Gideon Schechtman, 有界算子代数中封闭理想的数量 ................................ 3250
- Pablo Shmerkin, 切片和距离：关于Furstenberg和Falconer的两个问题 ...... 3266
- Konstantin Tikhomirov, 非厄米特随机矩阵的定量可逆性 ................................ 3292
- Stuart White, 可算群C*-代数的抽象分类定理 .................................... 3314
- Tianyi Zheng, 可数群上随机游走的渐近行为 ........................................ 3340

- 贡献者名单 ................................................................ 3367

# 第5卷 动力学-偏微分-数学物理

## 9.动力学

- Miklós Abért, 关于一个奇怪问题及其所导致的研究 .................................... 3374
- Aaron Brown, 作用在流形上的格子子群 ............................................ 3388
- Jon Chaika, Barak Weiss, 平移曲面模空间上的地平线流 ................................ 3412
- Mark F. Demers, 有限视界Sinai台球的拓扑熵和压力 ................................ 3432
- Romain Dujardin, 整性动力学中的几何方法 ........................................ 3460
- David Fisher, 刚性、格子和超越均匀动力学的不变测度 ................................ 3484
- Mariusz Lemańczyk, Furstenberg不相交性、Ratner性质和Sarnak猜想 ..................... 3508
- Amir Mohammadi, 均匀空间中的有限分析 ............................................ 3530
- Michela Procesi, 哈密顿PDE中的稳定性和递归解 .................................... 3552
- Corinna Ulcigrai, 高基因表面流的动力学和"算术" ................................ 3576
- Péter P. Varjú, 自相似集和线上的测度 ............................................ 3610

## 10.偏微分方程

- Tristan Buckmaster, Theodore D. Drivas, Steve Shkoller, Vlad Vicol, 可压缩欧拉方程的奇异性形成和发展 ................................................ 3636
- Pierre Cardaliaguet, François Delarue, 均场博弈中的选题 ................................ 3660
- Semyon Dyatlov, 混沌特征函数的宏观极限 ............................................ 3704
- Rita Ferreira, Irene Fonseca, Raghavendra Venkatraman, 均质化：旧的和新的 ............................................................ 3724
- Rupert L. Frank, Lieb-Thirring不等式和其他正交系统的泛函不等式 ..................... 3756
- Alexandru D. Ionescu, Hao Jia, 剪切流和涡旋的非线性稳定性 ................................ 3776
- Mathieu Lewin, 量子系统的均场极限和非线性Gibbs测度 ................................ 3800
- Kenji Nakanishi, 围绕和远离孤子的全局动力学 ........................................ 3822
- Alexander I. Nazarov, 分数阶拉普拉斯算子的多样性 ........................................... 3842
- Galina Perelman, 非线性色散偏微分方程中奇异性的形成 ................................ 3854
- Gabriella Tarantello, Teichmüller理论中Donaldson泛函的极小化问题渐近性 .............. 3880
- Dongyi Wei, Zhifei Zhang, 高雷诺数下的流体动力学稳定性 ................................ 3902

## 11.数学物理 - 特别讲座

- Peter Hintz, Gustav Holzegel, 广义相对论中的近期进展 ................................ 3924

- Roland Bauerschmidt, Tyler Helmuth, 双曲对称的自旋系统：综述 .............................. 3986
- Federico Bonetto, Eric Carlen, Michael Loss, Kac模型：主题的变化 .................... 4010
- Søren Fournais, Jan Philip Solovej, 稀薄Bose气体的能量 ................................ 4026
- Alessandro Giuliani, Ising和二聚体模型的尺度极限和普适性 .............................. 4040
- Matthew B. Hastings, 带隙量子系统：从高维Lieb-Schultz-Mattis到量子霍尔效应 ........................................................ 4074
- Karol Kajetan Kozlowski, 1+1维可积量子场理论的自举方法：sinh-Gordon模型案例 ........................................................ 4096
- Jonathan Luk, 广义相对论中的奇点 .................................................... 4120
- Yoshiko Ogata, 量子自旋系统中带隙基态相的分类 ................................... 4142
- 贡献者名单 ................................................................ 4163

# 第6卷 概率-组合-计科与数学

## 12.概率论

- Elchanan Mossel, 组合统计和科学 ................................................. 4170

- Jinho Baik, KPZ极限定理 .............................................................. 4190
- Jian Ding, Julien Dubédat, Ewain Gwynne, 李乌维尔量子引力度量简介 ........................................................... 4212
- Ronen Eldan, 使用路径方法分析高维分布 ............................................... 4246
- Alison Etheridge, 空间结构化群体中的自然选择 ........................................ 4272
- Tadahisa Funaki, 界面运动相关的流体动力学极限和随机PDEs ........................... 4302
- Patrícia Gonçalves, 来自相互作用粒子系统的普适性 ..................................... 4326
- Hubert Lacoin, 一维粒子系统的混合时间和截止 ........................................ 4350
- Dmitry Panchenko, 自旋玻璃中的超度量性 ............................................ 4376
- Kavita Ramanan, 稀疏随机图上的相互作用随机过程 ........................................ 4394
- Daniel Remenik, KPZ普适性类别中的可积涨落 ............................................ 4426
- Laurent Saloff-Coste, Harnack流形及其扩展上的热核估计 ...................................... 4452

## 13.组合学 - 特别讲座

- Melanie Matchett Wood, 数论中随机群的概率理论 ..................................... 4476

- Federico Ardila-Mantilla, 几何的几何学：新旧图论 ........................................ 4510
- Julia Böttcher, 图和超图填充 ........................................................ 4542
- Ehud Friedgut, KKL对我的影响 ...................................................... 4568
- Allen Knutson, Schurbert演算和秩变 .................................................... 4582
- Sergey Norin, 朝着Hadwiger猜想的最新进展 ............................................ 4606
- Isabella Novik, 面数：故事的上限部分 ................................................. 4622
- Mathias Schacht, 极值组合学中的受限问题 ............................................ 4646
- Alex Scott, 大色数图 ................................................................ 4660
- Asaf Shapira, 局部与全局组合学 .................................................... 4682
- Lauren K. Williams, 正Grassmannian, 扩幅多面体和簇代数 ................................ 4710

## 14.计算机科学中的数学 - 特别讲座

- Cynthia Dwork, 差分隐私：少付出多得到 ............................................ 4740
- Aayush Jain, Huijia Lin, Amit Sahai, 不可区分的混淆 .................................... 4762
- David Silver, Andre Barreto, 基于模拟的搜索控制 ........................................ 4800
- Bernd Sturmfels, 超越线性代数 ...................................................... 4820

- Roy Gotlib, Tali Kaufman, 无处可去只能走高：关于高维扩展器的视角 ............................. 4842
- Jelani Nelson, 频繁项四十年 ........................................................ 4872
- Oded Regev, 与逆Minkowski定理相关的一些问题 ........................................ 4898
- Muli (Shmuel) Safra, 通过线性方程和格透镜看计算数学 ................................ 4914
- Ola Svensson, 组合优化中的多面体技术：匹配和旅行 ................................ 4970
- Thomas Vidick, MIP* = RE: Connes嵌入问题和Tsirelson问题的否定解决 ............................. 4996

- 贡献者名单 ................................................................ 5027

# 第7卷 数值-控制-统计-数据-建模-教育-数学史

## 15.数值分析与科学计算

- Gang Bao, 逆散射问题的数学分析和数值方法 ............................................ 5034
- Marsha J. Berger, Randall J. LeVeque, 来自小行星撞击的色散海啸传播的自适应模拟 ........................................................ 5056
- Jan S. Hesthaven, Cecilia Pagliantini, Nicolò Ripamonti, 哈密顿系统的结构保持模型降阶 ........................................................ 5072
- Nicholas J. Higham, 极大规模和低精度下算法的数值稳定性 ................................ 5098
- Gitta Kutyniok, 人工智能的数学 ......................................................... 5118
- Rachel Ward, 随机梯度下降：优化与机器学习的交汇 ........................................ 5140
- Lexing Ying, 使用深度学习解决逆问题 .................................................... 5154

## 16.控制理论和优化 - 特别讲座

- Nikhil Bansal, 差异理论及相关算法 .................................................... 5178

- Regina S. Burachik, 扩展：在最大单调性和凸性之间架起桥梁 ................................ 5212
- Martin Burger, 半范数的非线性特征值问题及应用 ........................................ 5234
- Coralia Cartis, Nicholas I. M. Gould, Philippe L. Toint, 寻找非凸优化问题高阶最小化解的评估复杂性 ........................................................ 5256
- Yu-Hong Dai, 非线性优化概述 ........................................................ 5290
- Qi Lü, 随机分布参数系统的控制理论：最新进展和开放问题 ................................ 5314
- Asuman Ozdaglar, Muhammed O. Sayin, Kaiqing Zhang, 随机博弈中的独立学习 ........................................................ 5340
- Marius Tucsnak, 无限维线性系统的可达状态：旧的和新的 ................................ 5374

## 17.统计学与数据分析

- Francis Bach, Lénaïc Chizat, 无限宽神经网络上的梯度下降：全局收敛性和泛化 ........................................................ 5398
- Bin Dong, 图像重建及其之外的数学建模 ............................................ 5420
- Stefanie Jegelka, 图神经网络理论：表示与学习 ............................................ 5450
- Oleg V. Lepski, 自适应估计理论 .............................................................. 5478
- Gábor Lugosi, 高维均值估计 ................................................................ 5500
- Richard Nickl, Gabriel P. Paternain, 非线性统计逆问题的某些信息论方面 ........................................................ 5516
- Bernhard Schölkopf, Julius von Kügelgen, 从统计学到因果学习 ................................ 5540
- Cun-Hui Zhang, 二阶和更高阶高斯反集中不等式及Slepian比较定理中的误差界限 ........................................................ 5594

## 18.随机和微分建模

- Jacob Bedrossian, Alex Blumenthal, Sam Punshon-Smith, 随机微分方程的Lyapunov指数的下界 ........................................................ 5618
- Nicolas Champagnat, Sylvie Méléard, Viet Chi Tran, 多尺度生态进化模型：从个体到群体 ........................................................ 5656
- Hyeonbae Kang, 高对比度接近包含体存在下场浓度的定量分析 ................................ 5680

## 19.数学教育与数学普及

- Clara I. Grima, Scutoid的拥抱 .............................................................. 5702
- Anna Sfard, 从数学到数学教育的漫长道路：教育研究如何改变一个人对数学及其学习和教学的看法 ........................................................ 5716

## 20.数学史

- June Barrow-Green, George Birkhoff遗失的手稿和他的动力学计划 ................................ 5748
- Annette Imhausen, 从遥远历史视角看数学的一些用途和关联 ................................ 5772
- Krishnamurthi Ramasubramanian, 发现印度微积分的历史和史学 ................................ 5784

- 贡献者名单 ................................................................ 5813



# RATIONAL APPROXIMATIONS OF IRRATIONAL NUMBERS DIMITRIS KOUKOULOPOULOS

## ABSTRACT

Given quantities ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$, a fundamental problem in Diophantine approximation is to understand which irrational numbers $x$ have infinitely many reduced rational approximations $a/q$ such that $\left| {x - a/q}\right| < {\Delta }_{q}$ . Depending on the choice of ${\Delta }_{q}$ and of $x$, this question may be very hard. However, Duffin and Schaeffer conjectured in 1941 that if we assume a "metric" point of view, the question is governed by a simple zero-one law: writing $\varphi$ for Euler’s totient function, we either have $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} = \infty$ and then almost all irrational numbers (in the Lebesgue sense) are approximable, or $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} < \infty$ and almost no irrationals are approximable. We will present the history of the Duffin-Schaeffer conjecture and the main ideas behind the recent work of Koukoulopoulos-Maynard that settled it.

## MATHEMATICS SUBJECT CLASSIFICATION 2020

Primary 11J83; Secondary 05C40

## KEYWORDS

Diophantine approximation, Duffin-Schaeffer conjecture, Metric Number Theory,

compression arguments, density increment, graph theory

---

Published by EMS Press

and licensed under

a CC BY 4.0 license

---

(C) 2022 International Mathematical Union Proc. Int. Cong. Math. 2022, Vol. 3, pp. 1894-1916 DOI 10.4171/ICM2022/84

## 1. DIOPHANTINE APPROXIMATION

Let $x$ be an irrational number. In many settings, practical and theoretical, it is important to find fractions $a/q$ of small numerator and denominator that approximate it well. This fundamental question lies at the core of the field of Diophantine approximation.

## 1.1. First principles

The "high-school way" of approximating $x$ is to use its decimal expansion. This approach produces fractions $a/{10}^{n}$ such that $\left| {x - a/{10}^{n}}\right| \approx {10}^{-n}$ typically. However, the error can be made much smaller if we allow more general denominators [14, THEOREM 2.1].

Theorem 1.1. If $x \in \mathbb{R} \smallsetminus \mathbb{Q}$, then $\left| {x - a/q}\right| < {q}^{-2}$ for infinitely many pairs $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ .

Dirichlet (c. 1840) gave a short and clever proof of this theorem. However, his argument is nonconstructive because it uses the pigeonhole principle. This gap is filled by the theory of continued fractions (which actually precedes Dirichlet's proof).

Given any $x \in \mathbb{R} \smallsetminus \mathbb{Q}$, we may write $x = {n}_{0} + {r}_{0} \approx {n}_{0}$, where ${n}_{0} = \lfloor x\rfloor$ is the integer part of $x$ and ${r}_{0} = \{ x\}$ is its fractional part. We then let ${n}_{1} = \left\lfloor {1/{r}_{0}}\right\rfloor$ and ${r}_{1} = \left\{ {1/{r}_{0}}\right\}$, so that $x = {n}_{0} + 1/\left( {{n}_{1} + {r}_{1}}\right) \approx {n}_{0} + 1/{n}_{1}$ . If we repeat this process $j - 1$ more times, we find that

$$
x \approx {n}_{0} + \frac{1}{{n}_{1} + \frac{1}{\cdots + \frac{1}{{n}_{j}}}}\;\text{with}\;{n}_{i} = \left\lfloor \frac{1}{{r}_{i - 1}}\right\rfloor ,\;{r}_{i} = \left\{ \frac{1}{{r}_{i - 1}}\right\} \;\text{for}\;i = 1,\ldots, j. \tag{1.1}
$$

If we write this fraction as ${a}_{j}/{q}_{j}$ in reduced form, then a calculation reveals that

$$
{a}_{j} = {n}_{j}{a}_{j - 1} + {a}_{j - 2}\;\left( {j \geq 2}\right) ,\;{a}_{1} = {n}_{0}{n}_{1} + 1,\;{a}_{0} = {n}_{0}, \tag{1.2}
$$

$$
{q}_{j} = {n}_{j}{q}_{j - 1} + {q}_{j - 2}\;\left( {j \geq 2}\right) ,\;{q}_{1} = {n}_{1},\;{q}_{0} = 1.
$$

When $j \rightarrow \infty$, the right-hand side of (1.1), often denoted by $\left\lbrack {{n}_{0};{n}_{1},\ldots ,{n}_{j}}\right\rbrack$, converges to $x$ . The resulting representation of $x$ is called its continued fraction expansion. The quotients ${a}_{j}/{q}_{j}$ are called the convergents of this expansion and they have remarkable properties [17]. We list some of them below, with the first giving a constructive proof of Theorem 1.1.

Theorem 1.2. Assume the above set-up and notations.

(a) For each $j \geq 0$, we have $1/\left( {2{q}_{j}{q}_{j + 1}}\right) \leq \left| {x - {a}_{j}/{q}_{j}}\right| \leq 1/\left( {{q}_{j}{q}_{j + 1}}\right)$ .

(b) For each $j \geq 0$, we have $\left| {x - {a}_{j}/{q}_{j}}\right| = \min \left\{ {\left| {x - a/q}\right| : 1 \leq q \leq {q}_{j}}\right\}$ .

(c) If $\left| {x - a/q}\right| < 1/\left( {2{q}^{2}}\right)$ with a and $q$ coprime, then $a/q = {a}_{j}/{q}_{j}$ for some $j \geq 0$ .

## 1.2. Improving Dirichlet's approximation theorem

It is natural to ask when a qualitative improvement of Theorem 1.1 exists. Inverting this question leads us to the following definition: we say that a real number $x$ is badly approximable if there is $c = c\left( x\right) > 0$ such that $\left| {x - a/q}\right| \geq c{q}^{-2}$ for all $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ .

We can characterize approximable numbers in terms of their continued fraction expansion. Indeed, Theorem 1.2(a) and relation (1.2) imply that $1/4 \leq {n}_{j + 1}{q}_{j}^{2}\left| {x - {a}_{j}/{q}_{j}}\right| \leq 1$ .

Hence, together with Theorem 1.2(c), this implies that $x$ is badly approximable if and only if the sequence ${\left( {n}_{j}\right) }_{j = 0}^{\infty }$ is bounded. Famously, Lagrange proved that the quadratic irrational numbers are in one-to-one correspondence with the continued fractions that are eventually periodic $\left\lbrack {{17},\$ {10}}\right\rbrack$ . In particular, all such numbers are badly approximable.

A related concept to badly approximable numbers is the irrationality measure. For each $x \in \mathbb{R}$, we define it to be

$$
\mu \left( x\right) \mathrel{\text{:=}} \sup \left\{ {v \geq 0 : 0 < \left| {x - a/q}\right| < {q}^{-v}\text{ for infinitely many pairs }\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}}\right\} .
$$

Note that $\mu \left( x\right) = 1$ if $x \in \mathbb{Q}$, whereas $\mu \left( x\right) \geq 2$ if $x \in \mathbb{R} \smallsetminus \mathbb{Q}$ by Theorem 1.1. Moreover, $\mu \left( x\right) = 2$ if $x$ is badly approximable. In particular, $\mu \left( x\right) = 2$ for all quadratic irrationals $x$ . Remarkably, Roth [25] proved that $\mu \left( x\right) = 2$ for all algebraic irrational numbers $x$ .

Determining the irrationality measure of various famous transcendental constants is often very hard. We do know that $\mu \left( e\right) = 2$, where $e$ denotes Euler’s constant. However, determining $\mu \left( \pi \right)$ is a famous open problem. Towards it, Zeilberger and Zudilin [29] proved that $\mu \left( \pi \right) \leq {7.10320533}\ldots$ It is widely believed that $\mu \left( \pi \right) = 2$ .

Instead of trying to reduce the error term in Dirichlet's approximation theorem, we often require a different type of improvement: restricting the denominators $q$ to lie in some special set $\mathcal{S}$ . The theory of continued fractions is of limited use for such problems because the denominators it produces satisfy rigid recursive relations (cf. (1.2)).

For rational approximation with prime or square denominators, the best results at the moment are due to Matomäki [21] and Zaharescu [28], respectively.

Theorem 1.3 (Matomäki (2009)). Let $x$ be an irrational number and let $\varepsilon > 0$ . There are infinitely many integers $a$ and prime numbers $p$ such that $\left| {x - a/p}\right| < {p}^{-4/3 + \varepsilon }$ .

Theorem 1.4 (Zaharescu (1995)). Let $x$ be an irrational number and let $\varepsilon > 0$ . There are infinitely many pairs $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ such that $\left| {x - a/{q}^{2}}\right| < {q}^{-8/3 + \varepsilon }$ .

Two important open problems are to show that Theorems 1.3 and 1.4 remain true even if we replace the constants $4/3$ and $8/3$ by 2 and 3, respectively.

## 2. METRIC DIOPHANTINE APPROXIMATION

Unable to answer simple questions about the rational approximations of specific numbers, a lot of research adopted a more statistical point of view. For example, given $M > 2$ , what proportion of real numbers have irrationality measure $\geq M$ ? This new perspective gives rise to the theory of metric Diophantine approximation, which has a much more analytic and probabilistic flavor than the classical theory of Diophantine approximation. As we will see, the ability to ignore small pathological sets of numbers leads to a much more robust theory that provides simple and satisfactory answers to very general questions.

In order to give precise meaning to the word "proportion," we shall endow $\mathbb{R}$ with a measure. Here, we will mainly use the Lebesgue measure (denoted by "meas").

## 2.1. The theorems of Khinchin and Jarník-Besicovitch

The foundational result in the field of metric Diophantine approximation was proven by Khinchin in his seminal 1924 paper [18]. It is a rather general result: given a sequence ${\Delta }_{1},{\Delta }_{2},\ldots , \geq 0$ of "permissible margins of error," we wish to determine for which real numbers $x$ there are infinitely many pairs $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ such that $\left| {x - a/q}\right| < {\Delta }_{q}$ . Clearly, if $x$ has this property, so does $x + 1$ . Hence, we may focus on studying

$$
\mathcal{A} \mathrel{\text{:=}} \left\{ {x \in \left\lbrack {0,1}\right\rbrack : \left| {x - a/q}\right| < {\Delta }_{q}\text{ for infinitely many pairs }\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}}\right\} . \tag{2.1}
$$

Theorem 2.1 (Khinchin (1924)). Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$ and let $\mathcal{A}$ be defined as in (2.1).

(a) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }q{\Delta }_{q} < \infty$, then $\operatorname{meas}\left( \mathcal{A}\right) = 0$ .

(b) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }q{\Delta }_{q} = \infty$ and the sequence ${\left( {q}^{2}{\Delta }_{q}\right) }_{q = 1}^{\infty }$ is decreasing, then $\operatorname{meas}\left( \mathcal{A}\right) = 1$ .

Corollary 2.2. For almost all $x \in \mathbb{R}$, we have $\left| {x - a/q}\right| \leq 1/\left( {{q}^{2}\log q}\right)$ for infinitely many $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ . On the other hand, if $c > 1$ is fixed, then for almost every $x \in \mathbb{R}$, the inequality $\left| {x - a/q}\right| \leq 1/\left( {{q}^{2}{\log }^{c}q}\right)$ admits only finitely many solutions $\left( {a, q}\right) \in \mathbb{Z} \times \mathbb{N}$ .

In particular, Corollary 2.2 implies that the set of badly approximable numbers has null Lebesgue measure. On the other hand, it also says that almost all real numbers have irrationality measure equal to 2 . This last result is the main motivation behind the conjecture that $\mu \left( \pi \right) = 2$ : we expect $\pi$ to behave like a "typical" real number.

Naturally, the fact that ${\mathcal{W}}_{M} \mathrel{\text{:=}} \{ x \in \mathbb{R} : \mu \left( x\right) \geq M\}$ has null Lebesgue measure for $M > 2$ raises the question of determining its Hausdorff dimension (denoted by $\dim \left( {\mathcal{W}}_{M}\right)$ ). Jarník [16] and Besicovitch [5] answered this question independently of each other.

Theorem 2.3 (Jarník (1928), Besicovitch (1934)). We have $\dim \left( {\mathcal{W}}_{M}\right) = 2/M$ for all $M \geq 2$ .

## 2.2. Generalizing Khinchin's theorem

Following the publication of Khinchin's theorem, research focused on weakening the assumption that ${q}^{2}{\Delta }_{q} \searrow$ in part (b). Importantly, doing so would open the door to understanding rational approximations using only a restricted set of denominators. Indeed, if ${q}^{2}{\Delta }_{q} \searrow$, then either ${\Delta }_{q} > 0$ for all $q$, or there is ${q}_{0}$ such that ${\Delta }_{q} = 0$ for all $q \geq {q}_{0}$ . The second case is trivial, since it implies $\mathcal{A} = \varnothing$ . So, if we wish to understand Diophantine approximation with a restricted set of denominators $S$ (which would require ${\Delta }_{q} = 0$ for $q \notin S$ ), then we must prove a version of Theorem 2.1(b) without the assumption that ${q}^{2}{\Delta }_{q} \searrow$ .

In order to understand better the forces at play here, it is useful to recast Khinchin's theorem in probabilistic terms. For each $q$, let us define the set

$$
{\mathcal{A}}_{q} \mathrel{\text{:=}} \left\{ {x \in \left\lbrack {0,1}\right\rbrack : \text{ there is }a \in \mathbb{Z}\text{ such that }\left| {x - \frac{a}{q}}\right| < {\Delta }_{q}}\right\}
$$

$$
= \left\lbrack {0,1}\right\rbrack \cap \mathop{\bigcup }\limits_{{0 \leq a \leq q}}\left( {\frac{a}{q} - {\Delta }_{q},\frac{a}{q} + {\Delta }_{q}}\right) . \tag{2.2}
$$

Then $\mathcal{A} = \left\{ {x \in \left\lbrack {0,1}\right\rbrack : x \in {\mathcal{A}}_{q}\text{infinitely often}}\right\}$, which we often write as $\mathcal{A} = \lim \mathop{\sup }\limits_{{q \rightarrow \infty }}{\mathcal{A}}_{q}$ . We may thus view $\mathcal{A}$ as the event that for a number chosen uniformly at random from $\left\lbrack {0,1}\right\rbrack$ , an infinite number of the events ${\mathcal{A}}_{1},{\mathcal{A}}_{2},\ldots$ occur. A classical result from probability theory due to Borel and Cantelli [14, LEMMAS 1.2 & 1.3] studies precisely this kind of questions.

Theorem 2.4. Let $\left( {\Omega ,\mathcal{F},\mathbb{P}}\right)$ be a probability space, let ${E}_{1},{E}_{2},\ldots$ be events in that space, and let $E = \mathop{\limsup }\limits_{{j \rightarrow \infty }}{E}_{j}$ be the event that infinitely many of the ${E}_{j}$ ’s occur.

(a) (The first Borel-Cantelli lemma) If $\mathop{\sum }\limits_{{j = 1}}^{\infty }\mathbb{P}\left( {E}_{j}\right) < \infty$, then $\mathbb{P}\left( E\right) = 0$ .

(b) (The second Borel-Cantelli lemma) If $\mathop{\sum }\limits_{{j = 1}}^{\infty }\mathbb{P}\left( {E}_{j}\right) = \infty$ and the events ${E}_{1},{E}_{2},\ldots$ are mutually independent, then $\mathbb{P}\left( E\right) = 1$ .

Remark. Let $N$ be the random variable that counts how many of the events ${E}_{1},{E}_{2},\ldots$ occur. We have $\mathbb{E}\left\lbrack N\right\rbrack = \mathop{\sum }\limits_{{j = 1}}^{\infty }\mathbb{P}\left( {E}_{j}\right)$ . Hence, Theorem 2.4 says that, under certain assumptions, $N = \infty$ almost surely if, and only if, $\mathbb{E}\left\lbrack N\right\rbrack = \infty$ .

To use the above result in the setup of Khinchin’s theorem, we let $\Omega = \left\lbrack {0,1}\right\rbrack$ and equip it with the Lebesgue measure as its probability measure. The relevant events ${E}_{j}$ are the sets ${\mathcal{A}}_{q}$ . Notice that if ${\Delta }_{q} > 1/\left( {2q}\right)$, then ${\mathcal{A}}_{q} = \left\lbrack {0,1}\right\rbrack$, in which case ${\mathcal{A}}_{q}$ occurs immediately for all $x \in \left\lbrack {0,1}\right\rbrack$ . In order to avoid these trivial events, we will assume from now on that

$$
{\Delta }_{q} \leq 1/\left( {2q}\right) \;\text{ for all }q \geq 1,\;\text{ whence }\operatorname{meas}\left( {\mathcal{A}}_{q}\right) = {2q}{\Delta }_{q}. \tag{2.3}
$$

In particular, we see that part (a) of Khinchin's theorem is a direct consequence of the first Borel-Cantelli lemma. On the other hand, the second Borel-Cantelli lemma relies crucially on the assumption that the events ${E}_{j}$ are independent of each other, something that fails generically for the events ${\mathcal{A}}_{q}$ . However, there are variations of the second Borel-Cantelli lemma, where the assumption of independence can be replaced by weaker quasi-independence conditions on the relevant events (cf. Section 3.1). From this perspective, part (b) of Khinchin's theorem can be seen as saying that the condition that the sequence ${\left( {q}^{2}{\Delta }_{q}\right) }_{q = 1}^{\infty }$ is decreasing guarantees enough approximate independence between the events ${\mathcal{A}}_{q}$ so that the conclusion of the second Borel-Cantelli lemma remains valid.

In 1941, Duffin and Schaeffer published a seminal paper [8] that studied precisely what is the right way to generalize Khinchin's theorem so that the simple zero-one law of Borel-Cantelli holds. Their starting point was the simple observation that certain choices of the quantities ${\Delta }_{q}$ create many dependencies between the sets ${\mathcal{A}}_{q}$, thus rendering many of the denominators $q$ redundant. Indeed, note, for example, that if ${\Delta }_{3} = {\Delta }_{15}$, then ${\mathcal{A}}_{3} \subseteq {\mathcal{A}}_{15}$ because each fraction with denominator 3 can also be written as a fraction with denominator 15. By exploiting this simple idea, Duffin and Schaeffer proved the following result:

Proposition 2.5. There are ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$ such that $\mathop{\sum }\limits_{{q = 1}}^{\infty }q{\Delta }_{q} = \infty$ and yet $\operatorname{meas}\left( \mathcal{A}\right) = 0$ .

Proof. Let ${p}_{1} < {p}_{2} < \cdots$ be the primes in increasing order, let ${q}_{j} = {p}_{1}\cdots {p}_{j}$, and let ${S}_{j} = \left\{ {d{p}_{j} : d \mid {q}_{j - 1}}\right\}$ . We then set ${\Delta }_{q} = {\left( {q}_{j}j{\log }^{2}j\right) }^{-1}$ if $q \in {S}_{j}$ for some $j \geq 2$ ; otherwise, we set ${\Delta }_{q} = 0$ . We claim that this choice satisfies the needed conditions.

Since ${\mathcal{A}}_{q} \subseteq {\mathcal{A}}_{{q}_{j}}$ for all $q \in {\mathcal{S}}_{j}$, we have $\mathcal{A} = \mathop{\limsup }\limits_{{j \rightarrow \infty }}{\mathcal{A}}_{{q}_{j}}$ . In addition, since $\mathop{\sum }\limits_{{j = 1}}^{\infty }{q}_{j}{\Delta }_{{q}_{j}} < \infty$, we have meas(lim $\mathop{\sup }\limits_{{j \rightarrow \infty }}{\mathcal{A}}_{{q}_{j}}$ ) $= 0$ by Theorem 2.1(a). Hence, meas $\left( \mathcal{A}\right) = 0$, as needed. On the other hand, we have that

$$
\mathop{\sum }\limits_{{q \geq 1}}q{\Delta }_{q} = \mathop{\sum }\limits_{{j \geq 2}}\mathop{\sum }\limits_{{d \mid {q}_{j - 1}}}d{p}_{j} \cdot \frac{1}{{q}_{j}j{\log }^{2}j} = \mathop{\sum }\limits_{{j \geq 2}}\frac{1}{j{\log }^{2}j}\mathop{\prod }\limits_{{i \leq j - 1}}\left( {1 + \frac{1}{{p}_{i}}}\right) .
$$

By the Prime Number Theorem [19, THEOREM 8.1], the last product is $\geq c\log j$ for some absolute constant $c > 0$ . Consequently, $\mathop{\sum }\limits_{{q = 1}}^{\infty }q{\Delta }_{q} = \infty$, as claimed.

In order to avoid the above kind of counterexamples to the generalized Khinchin theorem, Duffin and Schaeffer were naturally led to consider a modified setup, where only reduced fractions are used as approximations. They thus defined

$$
{\mathcal{A}}^{ * } \mathrel{\text{:=}} \left\{ {x \in \left\lbrack {0,1}\right\rbrack : \left| {x - a/q}\right| < {\Delta }_{q}\text{ for infinitely many reduced fractions }a/q}\right\} . \tag{2.4}
$$

We may write ${\mathcal{A}}^{ * }$ as the lim sup of the sets

$$
{\mathcal{A}}_{q}^{ * } \mathrel{\text{:=}} \left\lbrack {0,1}\right\rbrack \cap \mathop{\bigcup }\limits_{\substack{{0 \leq a \leq q} \\ {\gcd \left( {a, q}\right) = 1} }}\left( {\frac{a}{q} - {\Delta }_{q},\frac{a}{q} + {\Delta }_{q}}\right) . \tag{2.5}
$$

Assuming that (2.3) holds, we readily find that

$$
\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) = {2\varphi }\left( q\right) {\Delta }_{q}
$$

where

$$
\varphi \left( q\right) \mathrel{\text{:=}} \# \{ 1 \leq a \leq q : \gcd \left( {a, q}\right) = 1\}
$$

is Euler’s totient function. They then conjectured that the sets ${\mathcal{A}}_{q}^{ * }$ have enough mutual quasi-independence so that a simple zero-one law holds, as per the Borel-Cantelli lemmas.

The Duffin-Schaeffer conjecture. Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$ and let ${\mathcal{A}}^{ * }$ be defined as in (2.4).

(a) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} < \infty$, then $\operatorname{meas}\left( {\mathcal{A}}^{ * }\right) = 0$ .

(b) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} = \infty$, then $\operatorname{meas}\left( {\mathcal{A}}^{ * }\right) = 1$ .

Of course, part (a) follows from Theorem 2.4(a); the main difficulty is to prove (b).

The Duffin-Schaeffer conjecture is strikingly simple and general. Nonetheless, it does not answer our original question: what is the correct generalization of Khinchin's theorem, where we may use nonreduced fractions? This gap was filled by Catlin [7].

Catlin’s conjecture. Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$, let ${\Delta }_{q}^{\prime } = \mathop{\sup }\limits_{{m \geq 1}}{\Delta }_{qm}$, and let $\mathcal{A}$ be as in (2.1).

(a) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}^{\prime } < \infty$, then $\operatorname{meas}\left( \mathcal{A}\right) = 0$ .

(b) If $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}^{\prime } = \infty$, then $\operatorname{meas}\left( \mathcal{A}\right) = 1$ .

As Catlin noticed, his conjecture is a direct corollary of that by Duffin and Schaeffer. Indeed, let us consider the set

${\mathcal{A}}^{\prime } = \left\{ {x \in \left\lbrack {0,1}\right\rbrack : \left| {x - a/q}\right| < {\Delta }_{q}^{\prime }\text{ for infinitely many reduced fractions }a/q}\right\} .$

This is the set ${\mathcal{A}}^{ * }$ with the quantities ${\Delta }_{q}$ replaced by ${\Delta }_{q}^{\prime }$, so we may apply the Duffin-Schaeffer conjecture to it. In addition, it is straightforward to check that

$$
\mathcal{A} \smallsetminus \mathbb{Q} = {\mathcal{A}}^{\prime } \smallsetminus \mathbb{Q} \tag{2.6}
$$

when ${\Delta }_{q} \rightarrow 0$ . This settles Catlin’s conjecture in this case. On the other hand, if ${\Delta }_{q} \nrightarrow 0$ , then $\mathcal{A} = \left\lbrack {0,1}\right\rbrack$ and $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}^{\prime } = \infty$, so that Catlin’s conjecture is trivially true.

Just like in Theorem 2.3 of Jarník and Besicovitch, it would be important to also have information about the Hausdorff dimension of the sets $\mathcal{A}$ and ${\mathcal{A}}^{ * }$ in the case when they have null Lebesgue measure. In light of relation (2.6), it suffices to answer this question for the latter set. Beresnevich and Velani [4] proved the remarkable result that the Duffin-Schaeffer conjecture implies a Hausdorff measure version of itself. This is a consequence of a much more general Mass Transfer Principle that they established, and which allows trans-fering information concerning the Lebesgue measure of certain lim sup sets to the Hausdorff measure of rescaled versions of them. As a corollary, they proved:

Theorem 2.6 (Beresnevich-Velani (2006)). Assume that the Duffin-Schaeffer conjecture is true. Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$ be such that $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} < \infty$ . Then the Hausdorff dimension of the set ${\mathcal{A}}^{ * }$ defined by (2.4) equals the infimum of the set of $s > 0$ such that $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}^{s} < \infty$ .

## 2.3. Progress towards the Duffin-Schaeffer conjecture

Since its introduction in 1941, the Duffin-Schaeffer conjectured has been the subject of intensive research activity, with various special cases proven over the years. This process came to a conclusion recently with the proof of the full conjecture [20].

Theorem 2.7 (Koukoulopoulos–Maynard (2020)). The Duffin–Schaeffer conjecture is true.

We will outline the main ideas of the proof of Theorem 2.7 in Section 3. But first we give an account of the work that preceeded it.

Notation. Given two functions $f, g : X \rightarrow \mathbb{R}$, we write $f\left( x\right) \ll g\left( x\right)$ (or $f\left( x\right) = O\left( {g\left( x\right) }\right)$ ) for all $x \in X$ to mean that there is a constant $C$ such that $\left| {f\left( x\right) }\right| \leq {Cg}\left( x\right)$ for all $x \in Y$ .

In the same paper where they introduced their conjecture, Duffin and Schaeffer proved the first general case of it:

Theorem 2.8 (Duffin-Schaeffer (1941)). The Duffin-Schaeffer conjecture is true for all sequences ${\left( {\Delta }_{q}\right) }_{q = 1}^{\infty }$ such that

$$
\mathop{\limsup }\limits_{{Q \rightarrow \infty }}\frac{\mathop{\sum }\limits_{{q \leq Q}}\varphi \left( q\right) {\Delta }_{q}}{\mathop{\sum }\limits_{{q \leq Q}}q{\Delta }_{q}} > 0. \tag{2.7}
$$

To appreciate this result, we must make a few comments about condition (2.7). Note that its left-hand side is the average value of $\varphi \left( q\right) /q$ over $q \in \left\lbrack {1, Q}\right\rbrack$, where $q$ is weighted by ${w}_{q} \mathrel{\text{:=}} q{\Delta }_{q}$ . In particular, we may restrict our attention to $q$ with ${\Delta }_{q} > 0$ . Now, we know

$$
\frac{\varphi \left( q\right) }{q} = \mathop{\prod }\limits_{{p \mid q}}\left( {1 - \frac{1}{p}}\right)
$$

In particular, $\varphi \left( q\right) /q \leq 1$, and the only way this ratio can become much smaller than 1 is if $q$ is divisible by lots of small primes. To see this, let us begin by observing that $q$ can have at most $\log q/\log 2$ prime factors in total. Therefore,

$$
\mathop{\prod }\limits_{{p \mid q, p > \log q}}\left( {1 - \frac{1}{p}}\right) \geq {\left( 1 - \frac{1}{\log q}\right) }^{\log q/\log 2} \geq \frac{1}{5} \tag{2.8}
$$

for $q$ large enough. In addition, we have

$$
\mathop{\prod }\limits_{\substack{{{\left( \log q\right) }^{0.01} < p \leq \log q} \\ {p \mid q} }}\left( {1 - \frac{1}{p}}\right) \geq \mathop{\prod }\limits_{{{\left( \log q\right) }^{0.01} < p \leq \log q}}\left( {1 - \frac{1}{p}}\right) \geq \frac{1}{200} \tag{2.9}
$$

for $q$ large enough by Mertens’ estimate [19, THEOREM 3.4]. Already the above inequalities show that only the primes $\leq {\left( \log q\right) }^{0.01}$ can affect the size of $\varphi \left( q\right) /q$ . But more is true: $\varphi \left( q\right) /q$ is small only if $q$ is divided by many primes $\leq {\left( \log q\right) }^{0.01}$ . Imagine, for example, that

$$
\# \left\{ {p \mid q : {e}^{j - 1} < p \leq {e}^{j}}\right\} \leq {e}^{j}/{j}^{2} + {1000} \tag{2.10}
$$

for $j = 1,2,\ldots ,1 + \lfloor {0.01}\log \log q\rfloor$ . We would then have

$$
\mathop{\prod }\limits_{\substack{{{e}^{j - 1} < p \leq {e}^{j}} \\ {p \mid q} }}\left( {1 - \frac{1}{p}}\right) \geq {\left( 1 - \frac{1}{{e}^{j}}\right) }^{{e}^{j}/{j}^{2} + {1000}} = \exp \left( {-1/{j}^{2} + O\left( {e}^{-j}\right) }\right) .
$$

Multiplying this over all $j$, we deduce that $\varphi \left( q\right) /q \geq c$ for some $c > 0$ independent of $q$ .

We have thus proven that for (2.7) to fail, the main contribution to the weighted sum $\mathop{\sum }\limits_{{q \leq Q}}{w}_{q}$ with ${w}_{q} = q{\Delta }_{q}$ must come from integers for which (2.10) fails. As a matter of fact,(2.10) must fail for lots of $j$ ’s. This is an extremely rare event if we choose $q$ uniformly at random from $\left\lbrack {1, Q}\right\rbrack$ (or even if we choose it uniformly at random from various "nice" subsets of $\left\lbrack {1, Q}\right\rbrack$, such as the primes, or the values of a monic polynomial with integer coefficients). A simple way to see this is to calculate the average value of the function $\# \left\{ {p \mid q : {e}^{j - 1} < }\right.$ $\left. {p \leq {e}^{j}}\right\}$ with respect to the uniform counting measure on $\left\lbrack {1, Q}\right\rbrack$ . We have

$$
\frac{1}{Q}\mathop{\sum }\limits_{{q \leq Q}}\# \left\{ {p \mid q : {e}^{j - 1} < p \leq {e}^{j}}\right\} = \mathop{\sum }\limits_{{{e}^{j - 1} < p \leq {e}^{j}}}\frac{\# \{ q \leq Q : p \mid q\} }{Q} \leq \mathop{\sum }\limits_{{{e}^{j - 1} < p \leq {e}^{j}}}\frac{1}{p} \ll \frac{1}{j}
$$

by Mertens’ theorem [19, THEOREM 3.4]. This is much smaller than ${e}^{j}/{j}^{2}$, so (2.10) should fail rarely as $j \rightarrow \infty$ . (For instance, we may use Markov’s inequality to see this claim.)

In conclusion, Theorem 2.8 settles the Duffin-Schaeffer conjecture when ${\Delta }_{q}$ is mainly supported on "normal" integers, without too many small prime factors. In particular, it implies a significant improvement of Theorems 1.3 and 1.4 for almost all $x \in \mathbb{R}$ .

Corollary 2.9. For almost all $x \in \mathbb{R}$, there are infinitely many reduced fractions $a/p$ and $b/{q}^{2}$ such that $p$ is prime, $\left| {x - a/p}\right| < {p}^{-2}$ and $\left| {x - b/{q}^{2}}\right| < {q}^{-3}$ .

The next important step towards the Duffin-Schaeffer conjecture is a remarkable zero-one law due to Gallagher [12].

Theorem 2.10 (Gallagher (1961)). If ${\mathcal{A}}^{ * }$ is as in (2.4), then meas $\left( {\mathcal{A}}^{ * }\right) \in \{ 0,1\}$ .

Gallagher’s theorem says grosso modo that either we chose the quantities ${\Delta }_{q}$ to be "too small" and thus missed almost all real numbers, or we chose them "sufficiently large" so that almost all numbers have the desired rational approximations. The Duffin-Schaeffer conjecture is then the simplest possible criterion to decide in which case we are.

The proof of Theorem 2.10 is a clever adaptation of an ergodic-theoretic argument due to Cassels [6] in the simpler setting of nonreduced rational approximations. We give Cassel’s proof and refer the interested readers to $\left\lbrack {{12},{14}}\right\rbrack$ for the proof of Theorem 2.10.

Theorem 2.11 (Cassels (1950)). If $\mathcal{A}$ is as in (2.1), then $\operatorname{meas}\left( \mathcal{A}\right) \in \{ 0,1\}$ .

Proof. We need the following fact [14, LEMMA 2.1] that uses Lebesgue's Density Theorem: Let ${I}_{1},{I}_{2},\ldots ,{J}_{1},{J}_{2},\ldots$ be intervals of lengths tending to 0, and let $c > 0$ . For all $k$, suppose ${J}_{k} \subseteq {I}_{k}$ and $\operatorname{meas}\left( {J}_{k}\right) \geq c\operatorname{meas}\left( {I}_{k}\right)$ . Then meas(lim $\mathop{\sup }\limits_{{k \rightarrow \infty }}{I}_{k} \smallsetminus \mathop{\limsup }\limits_{{k \rightarrow \infty }}{J}_{k}$ ) $= 0$ .

Now, for each $r \geq 1$, let ${\mathcal{A}}^{\left( r\right) }$ be defined as in (2.1) but with ${\Delta }_{q}/r$ in place of ${\Delta }_{q}$ . Hence, meas $\left( {\mathcal{A} \smallsetminus {\mathcal{A}}^{\left( r\right) }}\right) = 0$ by the above fact. Therefore, if ${\mathcal{A}}^{\left( \infty \right) } \mathrel{\text{:=}} \mathop{\bigcap }\limits_{{n = 1}}^{\infty }{\mathcal{A}}^{\left( n\right) }$, then $\operatorname{meas}\left( {\mathcal{A} \smallsetminus {\mathcal{A}}^{\left( \infty \right) }}\right) = 0$ . Now, consider the map $\psi : \left\lbrack {0,1}\right\rbrack \rightarrow \left\lbrack {0,1}\right\rbrack$ defined by $\psi \left( x\right) \mathrel{\text{:=}} \{ {2x}\}$ , and note that $\psi \left( {\mathcal{A}}^{\left( \infty \right) }\right) \subseteq {\mathcal{A}}^{\left( \infty \right) }$ . In particular, $\frac{1}{N}\mathop{\sum }\limits_{{n = 0}}^{{N - 1}}{1}_{{\mathcal{A}}^{\left( \infty \right) }}\left( {{\psi }^{n}\left( x\right) }\right) = 1$ for all $x \in {\mathcal{A}}^{\left( \infty \right) }$ and all $N \in \mathbb{N}$ . Since $\psi$ is ergodic with respect to the Lebesgue measure [26, P. 293 & 305-6], Birkhoff’s Ergodic Theorem [26, cH. 6, cor. 5.6] implies that meas $\left( {\mathcal{A}}^{\left( \infty \right) }\right) \in \{ 0,1\}$ .

The first significant step towards establishing the Duffin-Schaeffer conjecture for irregular sequences ${\Delta }_{q}$, potentially supported on integers with lots of small prime factors, was carried out by Erdős [10] and Vaaler [27].

Theorem 2.12 (Erdős (1970), Vaaler (1978)). The Duffin-Schaeffer conjecture is true for all sequences ${\left( {\Delta }_{q}\right) }_{q = 1}^{\infty }$ such that ${\Delta }_{q} = O\left( {1/{q}^{2}}\right)$ for all $q$ .

This theorem is, of course, most interesting when $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} = \infty$ . Since ${\Delta }_{q} = O\left( {1/{q}^{2}}\right)$ and $\varphi \left( q\right) \leq q$, we find $\mathop{\sum }\limits_{{q \in S}}1/q = \infty$ with $s = \left\{ {q : {\Delta }_{q} > 0}\right\}$ . In particular, $S$ must be somewhat dense in $\mathbb{N}$ . Therefore, Theorem 2.12 has the advantage over Theorem 2.8 that $S$ can contain many irregular integers, and the disadvantage that it has to be quite dense.

The Duffin-Schaeffer conjecture has a natural analogue in ${\mathbb{R}}^{k}$ with $k \geq 2$ : given ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$, let ${\mathcal{A}}^{ * }\left( k\right)$ be the set of $\overrightarrow{x} = \left( {{x}_{1},\ldots ,{x}_{k}}\right) \in {\mathbb{R}}^{k}$ for which there are infinitely many $k$ -tuples $\left( {{a}_{1}/q,\ldots ,{a}_{k}/q}\right)$ of reduced fractions with $\left| {{x}_{j} - {a}_{j}/q}\right| < {\Delta }_{q}$ for all $j$ . Then ${\mathcal{A}}^{ * }\left( k\right)$ should contain almost no or almost all $\overrightarrow{x} \in {\mathbb{R}}^{k}$, according to whether the series $\mathop{\sum }\limits_{{q = 1}}^{\infty }{\left( \varphi \left( q\right) {\Delta }_{q}\right) }^{k}$ converges or diverges. This was proven by Pollington and Vaughan [22].

Theorem 2.13 (Pollington–Vaughan (1990)). The $k$ -dimensional Duffin–Schaeffer conjecture is true for all $k \geq 2$ .

Following this result, a lot of research focused on proving the Duffin-Schaeffer conjecture when the series $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}$ diverges fast enough (see, e.g.,[14, THEOREM 3.7(III)], [3, 15]). Aistleitner, Lachmann, Munsch, Technau, and Zafeiropoulos [2] proved the Duffin-

Schaeffer conjecture when $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q}/{\left( \log q\right) }^{\varepsilon } = \infty$ for some $\varepsilon > 0$ . A report by Aistleit-ner [1], announced at the same time as [20], explains how to replace ${\left( \log q\right) }^{\varepsilon }$ by ${\left( \log \log q\right) }^{\varepsilon }$ .

## 3. THE MAIN INGREDIENTS OF THE PROOF OF THE DUFFIN-SCHAEFFER CONJECTURE

## 3.1. Borel-Cantelli without independence

Recall the definition of the sets ${\mathcal{A}}_{q}^{ * }$ in (2.5). Let us assume that ${\Delta }_{q} \leq 1/\left( {2q}\right)$ for all $q$ (cf. (2.3)) so that meas $\left( {\mathcal{A}}_{q}^{ * }\right) = {2\varphi }\left( q\right) {\Delta }_{q} \in \left\lbrack {0,1}\right\rbrack$, and let us also suppose that $\mathop{\sum }\limits_{{q = 1}}^{\infty }\varphi \left( q\right) {\Delta }_{q} = \infty$ . The first technical difficulty we must deal with is how to prove an analogue of the second Borel-Cantelli lemma (cf. Theorem 2.4(b)) without assuming that the events ${\mathcal{A}}_{q}^{ * }$ are independent. We follow an idea due to Turan, which is already present in [8].

By Gallagher’s zero-one law, it is enough to show that $\operatorname{meas}\left( {\mathcal{A}}^{ * }\right) > 0$ . Since $\mathop{\bigcup }\limits_{{q \geq Q}}{\mathcal{A}}_{q}^{ * } \searrow {\mathcal{A}}^{ * }$, we may equivalently prove that there is some constant $c > 0$ such that meas $\left( {\mathop{\bigcup }\limits_{{q \geq Q}}{\mathcal{A}}_{q}^{ * }}\right) \geq c$ for all large $Q$ . In order to limit the potential overlap among the sets ${\mathcal{A}}_{q}^{ * }$, we only consider an appropriate subset of them. Since meas $\left( {\mathcal{A}}_{q}^{ * }\right) = {2\varphi }\left( q\right) {\Delta }_{q} \in \left\lbrack {0,1}\right\rbrack$ for all $q$, and since $\mathop{\sum }\limits_{{q \geq Q}}\varphi \left( q\right) {\Delta }_{q} = \infty$, there must exist some $R \geq Q$ such that

$$
1 \leq \mathop{\sum }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) \leq 2 \tag{3.1}
$$

We will only use the events ${\mathcal{A}}_{q}^{ * }$ with $q \in \left\lbrack {Q, R}\right\rbrack$ . We trivially have the union bound

$$
\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}{\mathcal{A}}_{q}^{ * }}\right) \leq \mathop{\sum }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) \leq 2.
$$

If we can show that the sets ${\mathcal{A}}_{q}^{ * }$ with $q \in \left\lbrack {Q, R}\right\rbrack$ do not overlap too much, so that

$$
\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}{\mathcal{A}}_{q}^{ * }}\right) \geq c\mathop{\sum }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) \geq c, \tag{3.2}
$$

we will be able to deduce that $\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}{\mathcal{A}}_{q}^{ * }}\right) \geq c$ and a fortiori that meas $\left( {\mathop{\bigcup }\limits_{{q \geq Q}}{\mathcal{A}}_{q}^{ * }}\right) \geq c$ . As the following lemma shows,(3.2) is true under (3.1) as long as we can control the correlations of the events ${\mathcal{A}}_{q}^{ * }$ on average.

Lemma 3.1. Let ${E}_{1},\ldots ,{E}_{k}$ be events in the probability space $\left( {\Omega ,\mathcal{F},\mathbb{P}}\right)$ . We then have

that

$$
\mathbb{P}\left( {\mathop{\bigcup }\limits_{{j = 1}}^{k}{E}_{j}}\right) \geq \frac{{\left( \mathop{\sum }\limits_{{j = 1}}^{k}\mathbb{P}\left( {E}_{j}\right) \right) }^{2}}{\mathop{\sum }\limits_{{i, j = 1}}^{k}\mathbb{P}\left( {{E}_{i} \cap {E}_{j}}\right) }.
$$

Proof. Let $N = \mathop{\sum }\limits_{j}{1}_{{E}_{j}}$ . We then have $\mathbb{E}\left\lbrack N\right\rbrack = \mathop{\sum }\limits_{j}\mathbb{P}\left( {E}_{j}\right)$ . On the other hand, the Cauchy-Schwarz inequality implies that

$$
\mathbb{E}{\left\lbrack N\right\rbrack }^{2} = \mathbb{E}{\left\lbrack {1}_{N > 0} \cdot N\right\rbrack }^{2} \leq \mathbb{P}\left( {\operatorname{supp}\left( N\right) }\right) \cdot \mathbb{E}\left\lbrack {N}^{2}\right\rbrack .
$$

Since $\operatorname{supp}\left( N\right) = \mathop{\bigcup }\limits_{j}{E}_{j}$ and ${N}^{2} = \mathop{\sum }\limits_{{i, j}}{1}_{{E}_{i} \cap {E}_{j}}$, the lemma follows.

Proposition 3.2. Let ${\Delta }_{1},{\Delta }_{2},\cdots \geq 0$, and let ${\mathcal{A}}_{q}^{ * }$ be as in (2.5).

(a) If $C > 0$ and $R \geq Q \geq 1$ are such that

$$
1 \leq \mathop{\sum }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}\operatorname{meas}\left( {\mathcal{A}}_{q}^{ * }\right) \leq 2\;\text{ and }\;\mathop{\sum }\limits_{{Q \leq q < r \leq R}}\operatorname{meas}\left( {{\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * }}\right) \leq C, \tag{3.3}
$$

then $\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in \left\lbrack {Q, R}\right\rbrack }}{\mathcal{A}}_{q}^{ * }}\right) \geq 1/\left( {2 + {2C}}\right)$ .

(b) If there are infinitely many disjoint intervals $\left\lbrack {Q, R}\right\rbrack$ satisfying (3.3) with the same constant $C > 0$, then meas( $\lim \mathop{\sup }\limits_{{q \rightarrow \infty }}{\mathcal{A}}_{q}^{ * }$ ) $= 1$ .

## 3.2. A bound on the pairwise correlations

As per Proposition 3.2, we need to control the correlations of the events ${\mathcal{A}}_{q}^{ * }$ . To this end, we have a lemma of Pollington-Vaughan [22] (see also [10,27]).

Lemma 3.3. Let $q, r$ be two distinct integers $\geq 2$, let ${\Delta }_{q},{\Delta }_{r} \geq 0$, let ${\mathcal{A}}_{q}^{ * },{\mathcal{A}}_{r}^{ * }$ be as in (2.5), and let $M\left( {q, r}\right) = 2\max \left\{ {{\Delta }_{q},{\Delta }_{r}}\right\} \operatorname{lcm}\left\lbrack {q, r}\right\rbrack$ . If $M\left( {q, r}\right) \leq 1$, then ${\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * } = \varnothing$ . Otherwise,

$$
\operatorname{meas}\left( {{\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * }}\right) \ll \varphi \left( q\right) {\Delta }_{q} \cdot \varphi \left( r\right) {\Delta }_{r} \cdot \exp \left( {\mathop{\sum }\limits_{\substack{{p \mid {qr}/\gcd \left( {q, r}\right) } \\ {p > M\left( {q, r}\right) } }}\frac{1}{p}}\right) .
$$

Proof. Let $\Delta = \max \left\{ {{\Delta }_{q},{\Delta }_{r}}\right\} ,\delta = \min \left\{ {{\Delta }_{q},{\Delta }_{r}}\right\}$ and $M = M\left( {q, r}\right)$ . The intervals ${I}_{a} = \left( {\frac{a}{q} - {\Delta }_{q},\frac{a}{q} + {\Delta }_{q}}\right)$ and ${J}_{b} = \left( {\frac{b}{r} - {\Delta }_{r},\frac{b}{r} + {\Delta }_{r}}\right)$ intersect only if ${2\Delta } > \left| {\frac{a}{q} - \frac{b}{r}}\right|$ . Since the right-hand side is $\geq 1/\operatorname{lcm}\left\lbrack {q, r}\right\rbrack$ when $\gcd \left( {a, q}\right) = \gcd \left( {b, r}\right) = 1$, we infer that ${\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * } = \varnothing$ if $M \leq 1$ .

Now, assume that $M > 1$ . Since meas $\left( {{I}_{a} \cap {J}_{b}}\right) \leq {2\delta }$ for all $a, b$, we have

$$
\operatorname{meas}\left( {{\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * }}\right) \leq {2\delta } \cdot \# \left\{ {\begin{array}{ll} 1 \leq a \leq q, & \gcd \left( {a, q}\right) = 1 \\ 1 \leq b \leq r, & \gcd \left( {b, r}\right) = 1 \end{array} : \left| {\frac{a}{q} - \frac{b}{r}}\right| < {2\Delta }}\right\} .
$$

Let $a/q - b/r = m/\operatorname{lcm}\left\lbrack {q, r}\right\rbrack$ . Then $1 \leq \left| m\right| \leq M$ and $\gcd \left( {m,{q}_{1}{r}_{1}}\right) = 1$, where ${q}_{1} = q/d$ and ${r}_{1} = r/d$ with $d = \gcd \left( {q, r}\right)$ . For each such $m$, a straightforward application of the Chinese Remainder Theorem gives that the number of admissible pairs $\left( {a, b}\right)$ is

$$
\leq d\mathop{\prod }\limits_{{p \mid \gcd \left( {d,{q}_{1}{r}_{1}m}\right) }}\left( {1 - \frac{1}{p}}\right) \mathop{\prod }\limits_{{p \mid d, p \nmid {q}_{1}{r}_{1}m}}\left( {1 - \frac{2}{p}}\right) \leq d\frac{\mathop{\prod }\limits_{{p \mid d}}{\left( 1 - \frac{1}{p}\right) }^{2}}{\mathop{\prod }\limits_{{p \mid \gcd \left( {d,{q}_{1}{r}_{1}}\right) }}\left( {1 - \frac{1}{p}}\right) } \cdot \frac{\left| m\right| }{\varphi \left( \left| m\right| \right) },
$$

where we used that $1 - 2/p \leq {\left( 1 - 1/p\right) }^{2}$ . We then sum this inequality over $m$ and use Lemma 3.4 below to complete the proof. (For full details, see [22] or [14, LEMMA 2.8].)

Lemma 3.4. Fix $C \geq 1$, and let ${\left( {a}_{p}\right) }_{p\text{ prime }}$ be a sequence taking values in $\left\lbrack {0, C}\right\rbrack$ . Then

$$
\mathop{\sum }\limits_{{n \leq x}}\mathop{\prod }\limits_{{p \mid n}}{a}_{p}{ \ll }_{C}x\exp \left( {\mathop{\sum }\limits_{{p \leq x}}\frac{{a}_{p} - 1}{p}}\right) \text{ for all }x \geq 1.
$$

Proof. See Theorem 14.2 in [19].

## 3.3. Generalizing the Erdős-Vaaler argument

The next step is to study averages of $\exp \left( {\mathop{\sum }\limits_{{p \mid {qr}/\gcd {\left( q, r\right) }^{2}, p > M\left( {q, r}\right) }}1/p}\right)$ . This gets a bit too technical in general, so we focus on the following special case:

Theorem 3.5. Let $Q \geq N \geq 2$, and let $S \subseteq \{ Q \leq q \leq {2Q} : q$ square-free $\}$ be such that

$$
N/2 \leq \mathop{\sum }\limits_{{q \in S}}\frac{\varphi \left( q\right) }{q} \leq N. \tag{3.4}
$$

We then have

$$
\mathop{\sum }\limits_{{q, r \in S}}\frac{\varphi \left( q\right) \varphi \left( r\right) }{qr}\exp \left( {\mathop{\sum }\limits_{\substack{{p \mid {qr}/\gcd {\left( q, r\right) }^{2}} \\ {p > Q/\left\lbrack {N\gcd \left( {q, r}\right) }\right\rbrack } }}\frac{1}{p}}\right) \ll {N}^{2}. \tag{3.5}
$$

In particular, if ${\mathcal{A}}_{q}^{ * }$ is as in (2.5) with ${\Delta }_{q} = 1/\left( {qN}\right)$, then $\operatorname{meas}\left( {\mathop{\bigcup }\limits_{{q \in S}}{\mathcal{A}}_{q}^{ * }}\right) \gg 1$ .

Remark. To see the last assertion, recall the notation $M\left( {q, r}\right) = 2\max \left\{ {{\Delta }_{q},{\Delta }_{r}}\right\} \operatorname{lcm}\left\lbrack {q, r}\right\rbrack$ from Lemma 3.3. By the assumptions of the theorem, we have $M\left( {q, r}\right) \geq {2Q}/\left\lbrack {N\gcd \left( {q, r}\right) }\right\rbrack$ for $q, r \in S$ . Hence, if (3.5) holds, then $\mathop{\sum }\limits_{{q, r \in S}}\operatorname{meas}\left( {{\mathcal{A}}_{q}^{ * } \cap {\mathcal{A}}_{r}^{ * }}\right) \ll 1$ by Lemma 3.3. We may then apply Proposition 3.2 to deduce that meas $\left( {\mathop{\bigcup }\limits_{{q \in S}}{\mathcal{A}}_{q}^{ * }}\right) \gg 1$ .

When $N \gg Q$, Theorem 3.5 follows from the work of Erdős and Vaaler (Theorem 2.12), but when $N = o\left( Q\right)$ it was not known prior to [20] in this generality. The proof begins by adapting the Erdős-Vaaler argument to this more general setup.

First, we must control the sum over primes in (3.5). Using (2.10) turns out to be too crude, so we modify our approach. Let ${t}_{j} = \exp \left( {2}^{j}\right)$ and ${j}_{0}$ be such that $\mathop{\sum }\limits_{{t < p \leq {t}^{2}}}1/p \leq 1$ for $t \geq {t}_{{j}_{0}}$ ( ${j}_{0}$ exists by Mertens’ theorems [19, THEOREM 3.4].) Moreover, let

$$
\mathcal{L}\left( {q, r}\right) = \mathop{\sum }\limits_{\substack{{p \mid {qr}/\gcd {\left( q, r\right) }^{2}} \\ {p > Q/\left\lbrack {N\gcd \left( {q, r}\right) }\right\rbrack } }}\frac{1}{p},\;{\lambda }_{t}\left( q\right) = \mathop{\sum }\limits_{\substack{{p \mid q} \\ {p > t} }}\frac{1}{p},\;{L}_{t}\left( {q, r}\right) = \mathop{\sum }\limits_{\substack{{p \mid {qr}/\gcd {\left( q, r\right) }^{2}} \\ {p > t} }}\frac{1}{p}.
$$

If ${L}_{{t}_{{j}_{0}}}\left( {q, r}\right) \leq {101}$, then obviously $\mathcal{L}\left( {q, r}\right) \ll 1$ . Otherwise, there is an integer $j \geq {j}_{0}$ such that ${L}_{{t}_{j}}\left( {q, r}\right) > {101} \geq {L}_{{t}_{j + 1}}\left( {q, r}\right)$ . Since $j \geq {j}_{0}$, we then also have ${L}_{{t}_{j + 1}}\left( {q, r}\right) > {100}$ . Now, note that if $Q/\left\lbrack {N\gcd \left( {q, r}\right) }\right\rbrack \geq {t}_{j + 1}$, then $\mathcal{L}\left( {q, r}\right) \leq {L}_{{t}_{j + 1}}\left( {q, r}\right) \leq {101}$ .

To sum up, $\mathcal{L}\left( {q, r}\right) \ll 1$, unless $\left( {q, r}\right) \in {\mathcal{B}}_{{t}_{j + 1}}$ for some $j \geq {j}_{0}$, where

$$
{\mathcal{B}}_{t} \mathrel{\text{:=}} \left\{ {\left( {q, r}\right) \in S \times S : \gcd \left( {q, r}\right) > Q/\left( {Nt}\right) ,{L}_{t}\left( {q, r}\right) > {100}}\right\} .
$$

We study the contribution of such pairs to the left-hand side of (3.5): if $\left( {q, r}\right) \in {\mathcal{B}}_{{t}_{j + 1}}$, then

$$
\mathcal{L}\left( {q, r}\right) \leq {101} + \mathop{\sum }\limits_{{p \leq {t}_{j + 1}}}\frac{1}{p} \leq \log \log {t}_{j + 1} + O\left( 1\right) = j\log 2 + O\left( 1\right)
$$

by Mertens' estimate. In conclusion, Theorem 3.5 will follow if we can show that

$$
\mathop{\sum }\limits_{{\left( {q, r}\right) \in {\mathcal{B}}_{t}}}\frac{\varphi \left( q\right) \varphi \left( r\right) }{qr} \ll \frac{{N}^{2}}{t}\;\text{ for all }t \geq {t}_{{j}_{0} + 1} \tag{3.6}
$$

Now, let us consider the special case when $N \gg Q$, which corresponds to the Erdős-Vaaler theorem. The inequality $\gcd \left( {q, r}\right) > Q/\left( {Nt}\right)$ is then basically trivially, so we

must prove (3.6) by exploiting the condition ${L}_{t}\left( {q, r}\right) > {100}$ . Indeed, writing $d = \gcd \left( {q, r}\right)$ , $q = d{q}_{1}$ and $r = d{r}_{1}$, we find that ${\lambda }_{t}\left( {q}_{1}\right) > {50}$ or ${\lambda }_{t}\left( {r}_{1}\right) > {50}$ . By symmetry, we have

$$
\# {\mathcal{B}}_{t} \leq 2\mathop{\sum }\limits_{{d \leq {2Q}}}\# \left\{ {{r}_{1} \leq {2Q}/d}\right\} \cdot \# \left\{ {{q}_{1} \leq {2Q}/d : {\lambda }_{t}\left( {q}_{1}\right) > {50}}\right\} .
$$

The number of ${r}_{1}$ ’s is of course $\leq {2Q}/d$ . Moreover, using Chernoff’s inequality and Lemma 3.4 with ${a}_{p} = \exp \left( {{1}_{p > t} \cdot t/p}\right)$, we find that

$$
\# \left\{ {{q}_{1} \leq {2Q}/d : {\lambda }_{t}\left( {q}_{1}\right) > {50}}\right\} \leq \mathop{\sum }\limits_{{{q}_{1} \leq {2Q}/d}}\exp \left( {-{50t} + t{\lambda }_{t}\left( p\right) }\right) \ll {e}^{-{50t}}Q/d.
$$

Putting everything together, we conclude that

$$
\# {\mathcal{B}}_{t} \ll {e}^{-t}{Q}^{2}\;\text{ for all }t \geq 1 \tag{3.7}
$$

In particular,(3.6) holds, thus proving Theorem 3.5 when $N \gg Q$ .

On the other hand, if $N = o\left( Q\right)$, the condition that $\gcd \left( {q, r}\right) > Q/\left( {Nt}\right)$ for all $\left( {q, r}\right) \in {\mathcal{B}}_{t}$ is nontrivial and we must understand it and exploit it to prove Theorem 3.5. Indeed, if we treat the weights $\varphi \left( q\right) /q$ as roughly constant in (3.4), we see that $S$ contains about $N$ integers from $\left\lbrack {Q,{2Q}}\right\rbrack$, i.e., it is a rather sparse set. On the other hand, if $t$ is not too large, then (3.7) gives no savings compared to the trivial upper bound $\# {\mathcal{B}}_{t} \leq \# {S}^{2} \approx {N}^{2}$ .

Since the condition that ${L}_{t}\left( {q, r}\right) > {100}$ is insufficient, let us ignore it temporarily and focus on the condition that $\gcd \left( {q, r}\right) > Q/\left( {Nt}\right)$ for all $\left( {q, r}\right) \in {\mathcal{B}}_{t}$ . There is an obvious way in which this condition can be satisfied for many pairs $\left( {q, r}\right) \in \mathcal{S} \times \mathcal{S}$, namely if there is some fixed integer $d > Q/\left( {Nt}\right)$ that divides a large proportion of integers in $S$ . Notice that the number of total multiples of $d$ in $\left\lbrack {Q,{2Q}}\right\rbrack$ is about $Q/d < t \cdot N$, which is compatible with (3.4). We thus arrive at the following key question:

Model Problem. Let $D \geq 1$ and $\delta \in (0,1\rbrack$, and let $S \subseteq \left\lbrack {Q,{2Q}}\right\rbrack \cap \mathbb{Z}$ be a set of $\gg {\delta Q}/D$ elements such that there are $\geq \delta \# {S}^{2}$ pairs $\left( {q, r}\right) \in S \times S$ with $\gcd \left( {q, r}\right) > D$ . Must there be an integer $d > D$ that divides $\gg {\delta }^{100}Q/D$ elements of $S$ ?

It turns out that the answer to the Model Problem as stated is negative. However, a technical variant of it is true, that takes into account the weights $\varphi \left( q\right) /q$ in (3.4) and (3.6), and that is asymmetric in $q$ and $r$ . We shall explain this in the next section.

For now, let us assume that the Model Problem as stated has an affirmative answer, and let us see how this yields Theorem 3.5. Suppose (3.6) fails for some $t$ . By the Model Problem, there must exist an integer $d > N/\left( {Qt}\right)$ dividing $\gg {t}^{-{100}}\# S$ members of $S$ . We might then also expect that $\# {\mathcal{B}}_{t} \gg {t}^{-{200}}\# \left\{ {\left( {{dm},{dn}}\right) \in {\mathcal{B}}_{t} : m, n \geq 1}\right\}$ . But note that if $\left( {q, r}\right) = \left( {{dm},{dn}}\right) \in {\mathcal{B}}_{t}$, then $m, n \leq {2Q}/d < {2tN}$ and ${qr}/\gcd {\left( q, r\right) }^{2} = {mn}/\gcd {\left( m, n\right) }^{2}$ . In particular, ${L}_{t}\left( {m, n}\right) > {100}$, so the argument leading to (3.7) implies that the number of $\left( {{dm},{dn}}\right) \in {\mathcal{B}}_{t}$ is $\ll {e}^{-t}{t}^{2}{N}^{2}$ . Hence, ${\mathcal{B}}_{t} \ll {e}^{-t}{t}^{202}{N}^{2} \ll {N}^{2}/t$, as needed.

## 3.4. An iterative compression algorithm

To attack the Model Problem, we view it as a question in graph theory: consider the graph $G$, with vertex set $S$ and edge set ${\mathcal{B}}_{t}$ . If the edge density of $G$ is $\geq 1/t$, must there exist a dense subgraph ${G}^{\prime }$ all of whose vertices are divisible by an integer $> Q/\left( {Nt}\right)$ ?

To locate this "structured" subgraph ${G}^{\prime }$, we use an iterative "compression" argument, roughly inspired by the papers of Erdős-Ko-Rado [11] and Dyson [9]. With each iteration, we pass to a smaller set of vertices, where we have additional information about which primes divide them. Of course, we must ensure that we end up with a sizeable graph. We do this by judiciously choosing the new graph at each step so that it has at least as many edges as what the qualitative parameters of the old graph might naively suggest. This way the new graph will have improved "structure" and "quality." When the algorithm terminates, we will end up with a fully structured subset of $S$, where we know that all large GCDs are due to a large fixed common factor. This will then allow us to exploit the condition that ${L}_{t}\left( {q, r}\right) > {100}$ for all edges $\left( {q, r}\right)$ . Importantly, our algorithm will also control the set ${\mathcal{B}}_{t}$ in terms of the terminal edge set. Hence the savings from the condition ${L}_{t}\left( {q, r}\right) > {100}$ in the terminal graph will be transferred to ${\mathcal{B}}_{t}$, establishing (3.6).

One technical complication is that the iterative algorithm necessitates to view $G$ as a bipartite graph. In addition, it is important to use the weights $\varphi \left( q\right) /q$ . We thus set

$$
\mu \left( \mathcal{V}\right) = \mathop{\sum }\limits_{{v \in \mathcal{V}}}\frac{\varphi \left( v\right) }{v}\;\text{ for }\mathcal{V} \subset \mathbb{N};\;\mu \left( \mathcal{E}\right) = \mathop{\sum }\limits_{{\left( {v, w}\right) \in \mathcal{E}}}\frac{\varphi \left( v\right) \varphi \left( w\right) }{vw}\;\text{ for }\mathcal{E} \subset {\mathbb{N}}^{2}.
$$

Let us now explain the algorithm in more detail. We set ${\mathcal{V}}_{0} = {\mathcal{W}}_{0} = S$ and construct two decreasing sequences of sets ${\mathcal{V}}_{0} \supseteq {\mathcal{V}}_{1} \supseteq {\mathcal{V}}_{2} \supseteq \cdots$ and ${\mathcal{W}}_{0} \supseteq {\mathcal{W}}_{1} \supseteq {\mathcal{W}}_{2} \supseteq \cdots$, as well as a sequence of distinct primes ${p}_{1},{p}_{2},\ldots$ such that either ${p}_{j}$ divides all elements of ${\mathcal{V}}_{j}$, or it is coprime to all elements of ${\mathcal{V}}_{j}$ (and similarly with ${\mathcal{W}}_{j}$ ). Since $\mathcal{S}$ consists solely of square-free integers, there are integers ${a}_{j},{b}_{j}$ dividing ${p}_{1}\cdots {p}_{j}$, and such that $\gcd \left( {v,{p}_{1}\cdots {p}_{j}}\right) = {a}_{j}$ and $\gcd \left( {w,{p}_{1}\cdots {p}_{j}}\right) = {b}_{j}$ for all $v \in {\mathcal{V}}_{j}$ and all $w \in {\mathcal{W}}_{j}.$

Assume we have constructed ${\mathcal{V}}_{i},{\mathcal{W}}_{i},{p}_{i}$ as above for $i = 1,\ldots, j$ . Let ${\mathcal{E}}_{i} =$ ${\mathcal{B}}_{t} \cap \left( {{\mathcal{V}}_{i} \times {\mathcal{W}}_{i}}\right)$ be the edge sets. We then pick a new prime ${p}_{j + 1}$ that occurs as common factor of $\gcd \left( {v, w}\right)$ for at least one edge $\left( {v, w}\right) \in {\mathcal{E}}_{j}$ . (If there is no such prime, the algorithm terminates.) Then, we pick ${\mathcal{V}}_{j + 1}$ to be either ${\mathcal{V}}_{j}^{\left( 1\right) } \mathrel{\text{:=}} \left\{ {v \in {\mathcal{V}}_{j} : {p}_{j + 1} \mid v}\right\}$ or ${\mathcal{V}}_{j}^{\left( 0\right) } \mathrel{\text{:=}} \left\{ {v \in {\mathcal{V}}_{j}}\right.$ : $\left. {{p}_{j + 1} \nmid v}\right\}$ (and similarly with ${\mathcal{W}}_{j + 1}$ ). Deciding how to make this choice is the most crucial part of the proof and we will analyze it in more detail below. At any rate, it is clear that after a finite number of steps, this process will terminate. We will thus arrive at sets of vertices ${\mathcal{V}}_{J}$ and ${\mathcal{W}}_{J}$ where $a = {a}_{J}$ divides all elements of ${\mathcal{V}}_{J}, b = {b}_{J}$ divides all elements of ${\mathcal{W}}_{J}$, and $\gcd \left( {v, w}\right) = \gcd \left( {a, b}\right)$ for all edges $\left( {v, w}\right) \in {\mathcal{E}}_{J} \subseteq {\mathcal{B}}_{t}$ . In particular, $\gcd \left( {a, b}\right) > Q/\left( {Nt}\right)$ , as long as ${\mathcal{E}}_{J} \neq \varnothing$ . We have thus found our fixed large common divisor, so that we can use the Erdős-Vaaler argument as in Section 3.3 to control the size of ${\mathcal{E}}_{J}$ . If we can ensure that ${\mathcal{E}}_{J}$ is a large enough portion of ${\mathcal{E}}_{0} = {\mathcal{B}}_{t}$, we will have completed the proof.

Let us now explain how to make the choice of which subgraph to focus on each time. Let ${G}_{j} = \left( {{\mathcal{V}}_{j},{\mathcal{W}}_{j},{\mathcal{E}}_{j}}\right)$ be the bipartite graph at the $j$ th iteration. Because we will use an unbounded number of iterations, it is important to ensure that ${G}_{j + 1}$ has more edges than "what the qualitative parameters of ${G}_{j}$ would typically predict." One way to assign meaning to this vague phrase is to use the edge density $\# {\mathcal{E}}_{j}/\left( {\# {\mathcal{V}}_{j}\# {\mathcal{W}}_{j}}\right)$ . Actually, in our case, we should use the weighted density

$$
{\delta }_{j} = \frac{\mu \left( {\varepsilon }_{j}\right) }{\mu \left( {\mathcal{V}}_{j}\right) \mu \left( {\mathcal{W}}_{j}\right) }.
$$

Naively, we might guess that $\mu \left( {\mathcal{E}}_{j + 1}\right) \approx {\delta }_{j}\mu \left( {\mathcal{V}}_{j + 1}\right) \mu \left( {\mathcal{W}}_{j + 1}\right)$, meaning that ${\delta }_{j + 1} \approx {\delta }_{j}$ . So we might try to choose ${G}_{j + 1}$ so that ${\delta }_{j + 1} \geq {\delta }_{j}$ . This would be analogous to Roth’s "density increment" strategy $\left\lbrack {{23},{24}}\right\rbrack$ . Unfortunately, such an argument loses all control over the size of ${\mathcal{E}}_{j}$, so we cannot use information on ${\mathcal{E}}_{J}$ to control ${\mathcal{E}}_{0} = {\mathcal{B}}_{t}$ (which is our end goal).

In a completely different direction, we can use the special GCD structure of our graphs to come up with another "measure of quality" of our new graph compared to the old one. Recall the integers ${a}_{j + 1}$ and ${b}_{j + 1}$ . We then have

$$
\# {\mathcal{E}}_{j} \leq \# \left\{ {m \leq \frac{2Q}{{a}_{j}}, n \leq \frac{2Q}{{b}_{j}} : \gcd \left( {m, n}\right) > \frac{Q/\left( {Nt}\right) }{\gcd \left( {{a}_{j},{b}_{j}}\right) }}\right\} . \tag{3.8}
$$

If all pairs $\left( {m, n}\right)$ on the right-hand side of (3.8) were due to a fixed divisor of size $> \left\lbrack {Q/\left( {Nt}\right) }\right\rbrack /\gcd \left( {{a}_{j},{b}_{j}}\right)$, then we would conclude that

$$
\# {\mathcal{E}}_{j} \ll {t}^{2}{N}^{2} \cdot \frac{\gcd {\left( {a}_{j},{b}_{j}\right) }^{2}}{{a}_{j}{b}_{j}}.
$$

Actually, Green and Walker [13] proved recently that this bound is true, even without the presence of a universal divisor. So it makes sense to consider the quantity $\# {\mathcal{E}}_{j} \cdot {a}_{j}{b}_{j}/\gcd {\left( {a}_{j},{b}_{j}\right) }^{2}$ as a qualitative measure of ${G}_{j}$ . As a matter of fact, since we are weighing $v$ with $\varphi \left( v\right) /v$ , and we have $\varphi \left( v\right) /v \leq \varphi \left( {a}_{j}\right) /{a}_{j}$ whenever ${a}_{j} \mid v$, we may even consider

$$
{\lambda }_{j} \mathrel{\text{:=}} \frac{{a}_{j}{b}_{j}}{\gcd {\left( {a}_{j},{b}_{j}\right) }^{2}} \cdot \frac{{a}_{j}{b}_{j}}{\varphi \left( {a}_{j}\right) \varphi \left( {b}_{j}\right) } \cdot \mu \left( {\mathcal{E}}_{j}\right) .
$$

Let us see a different argument for why this quantity might be a good choice, by studying the effect of each prime $p \in \left\{ {{p}_{1},\ldots ,{p}_{j}}\right\}$ to the parameters $Q/{a}_{j}, Q/{b}_{j}$ and $\left\lbrack {Q/\left( {Nt}\right) }\right\rbrack /\gcd \left( {{a}_{j},{b}_{j}}\right)$ that control the size of $m, n$, and $\gcd \left( {m, n}\right)$, respectively, in (3.8):

- Case 1: $p \mid {a}_{j}$ and $p \mid {b}_{j}$ . Then $p$ reduces the upper bounds on the size of both $m$ and $n$ by a factor $1/p$ . On the other hand, it also reduces the lower bound on their GCD (that affects both $m$ and $n$ ) by $1/p$ . Hence, we are in a balanced situation.

- Case 2: $p \nmid {a}_{j}$ and $p \nmid {b}_{j}$ . In this case, $p$ affects no parameters.

- Case 3: $p \mid {a}_{j}$ and $p \nmid {b}_{j}$ . Then $p$ reduces the upper bound on $m$ by a factor $1/p$ , but it does not affect the bound on $n$ nor on $\gcd \left( {m, n}\right)$ . This is an advantageous situation, gaining us a factor of $p$ compared to what we had. Accordingly, ${\lambda }_{j}$ is multiplied by $p$ in this case. This gain allows us to afford a big loss of vertices when falling in this "asymmetric" case (a proportion of $1 - O\left( {1/p}\right)$ ).

- Case 4: $p \nmid {a}_{j}$ and $p \mid {b}_{j}$ . Then we gain a factor of $p$ as in the previous case.

Iteratively increasing ${\lambda }_{j}$ would be adequate for showing (3.6), by mimicking the Erdős-Vaaler argument from Section 3.3. Unfortunately, it is not possible to guarantee that

${\lambda }_{j}$ increases at each stage because it is not sensitive enough to the edge density, and so this proposal also fails. However, we will show that (a small variation of) the hybrid quantity

$$
{q}_{j} \mathrel{\text{:=}} {\delta }_{j}^{9}{\lambda }_{j} \tag{3.9}
$$

can be made to increase at each step, while keeping track of the sizes of the vertex sets. We call ${q}_{j}$ the quality of ${G}_{j}$ .

Let us now discuss how we might carry out the "quality increment" strategy. Given ${\mathcal{V}}_{j}$ and ${p}_{j + 1}$, we wish to set ${\mathcal{V}}_{j + 1} = {\mathcal{V}}_{j}^{\left( k\right) }$ and ${\mathcal{W}}_{j + 1} = {\mathcal{W}}_{j}^{\left( \ell \right) }$ for some $k,\ell \in \{ 0,1\}$ . Let us call ${G}_{j}^{\left( k,\ell \right) }$ each of the four potential choices for ${G}_{j + 1}$ . For their quality ${q}_{j}^{\left( k,\ell \right) }$, we have:

$$
\frac{{q}_{j}^{\left( 1,1\right) }}{{q}_{j}} = {\left( \frac{{\delta }^{\left( 1,1\right) }}{{\delta }_{j}}\right) }^{10}{\alpha \beta }{\left( 1 - \frac{1}{p}\right) }^{-2},\;\frac{{q}_{j}^{\left( 1,0\right) }}{{q}_{j}} = {\left( \frac{{\delta }_{j}^{\left( 1,0\right) }}{{\delta }_{j}}\right) }^{10}\alpha \left( {1 - \beta }\right) p{\left( 1 - \frac{1}{p}\right) }^{-1},
$$

$$
\frac{{q}_{j}^{\left( 0,1\right) }}{{q}_{j}} = {\left( \frac{{\delta }_{j}^{\left( 0,1\right) }}{{\delta }_{j}}\right) }^{10}\left( {1 - \alpha }\right) {\beta p}{\left( 1 - \frac{1}{p}\right) }^{-1},\;\frac{{q}_{j}^{\left( 0,0\right) }}{{q}_{j}} = {\left( \frac{{\delta }_{j}^{\left( 0,0\right) }}{{\delta }_{j}}\right) }^{10}\left( {1 - \alpha }\right) \left( {1 - \beta }\right) ,
$$

where ${\delta }_{j}^{\left( k,\ell \right) }$ is the edge density of ${G}_{j}^{\left( k,\ell \right) },\alpha = \mu \left( {\mathcal{V}}_{j}^{\left( 1\right) }\right) /\mu \left( {\mathcal{V}}_{j}\right)$ is the proportion of vertices in ${\mathcal{V}}_{j}$ that are divisible by ${p}_{j + 1}$, and similarly $\beta = \mu \left( {\mathcal{W}}_{j}^{\left( 1\right) }\right) /\mu \left( {\mathcal{W}}_{j}\right)$ . In addition, we have

$$
{\delta }_{j}^{\left( 1,1\right) }{\alpha \beta } + {\delta }_{j}^{\left( 1,0\right) }\alpha \left( {1 - \beta }\right) + {\delta }_{j}^{\left( 0,1\right) }\left( {1 - \alpha }\right) \beta + {\delta }_{j}^{\left( 0,0\right) }\left( {1 - \alpha }\right) \left( {1 - \beta }\right) = {\delta }_{j},
$$

so that if one of the ${\delta }_{j}^{\left( k,\ell \right) }$ ’s is smaller than $\delta$, some other must be larger. Such an unbalanced situation is advantageous, so let us assume that ${\delta }_{j}^{\left( k,\ell \right) } \sim {\delta }_{j}$ for all $k,\ell$ .

Notice that we have an extra factor $p$ in the asymmetric cases $\left( {0,1}\right)$ and $\left( {1,0}\right)$ . We can then easily obtain a quality increment in one of these two cases, unless $\alpha ,\beta \ll 1/p$, or if $\alpha ,\beta \geq 1 - O\left( {1/p}\right)$ . It turns out that the former case can be treated with a trick. So, the real difficulty is to obtain a quality increment when $\alpha ,\beta$ are both close to 1 . As a matter of fact, the critical case is when $\alpha ,\beta \sim 1 - 1/p$ . Indeed, we then have ${q}_{j}^{\left( k,\ell \right) } \sim 1$ in all four cases, so we maintain a constant quality no matter which subgraph we choose to focus on.

It is important to remark here that the factor ${\left( 1 - 1/p\right) }^{-2}$ in the case $\left( {k,\ell }\right) = \left( {1,1}\right)$ is essential (the factors ${\left( 1 - 1/p\right) }^{-1}$ in the asymmetric cases are less important as it turns out). Without this extra factor, we would not have been able to guarantee that the quality stays at least as big as ${q}_{j}$ . Crucially, this factor originates from the weights $\varphi \left( v\right) /v$ of the vertices that are naturally built in the Duffin-Schaeffer conjecture and that dampen down contributions from integers with too many prime divisors.

We conclude this discussion by going back to the Model Problem. We mentioned in Section 3.3 that this problem is false. The reason is a counterexample due to Sam Chow, a square-free version of which is given by $S = \{ P/j : j \mid P, x/2 \leq j \leq x\}$ with $P =$ $\mathop{\prod }\limits_{{p \leq x}}p$ . Indeed, all pairwise GCDs here are $\geq P/{x}^{2}$, but there is no fixed integer of size $\gg P/{x}^{2}$ dividing a positive proportion of elements of this set. In addition, note that if $p \leq$ $x/\log x$, then the proportion of $S$ divisible by $p$ is $\sim 1 - 1/p$, just like in the critical case discussed above.

## 3.5. The quality increment argument

We now discuss the formal details of our iterative algorithm. We must first set up some notation. We say that $G = \left( {\mathcal{V},\mathcal{W},\mathcal{E},\mathcal{P}, a, b}\right)$ is a square-free GCD graph if:

- $\mathcal{V}$ and $\mathcal{W}$ are nonempty, finite sets of square-free integers;

- $\left( {\mathcal{V},\mathcal{W},\mathcal{E}}\right)$ is a bipartite graph, meaning that $\mathcal{E} \subseteq \mathcal{V} \times \mathcal{W}$ ;

- $\mathcal{P}$ is a finite set of primes, and $a$ and $b$ divide $\mathop{\prod }\limits_{{p \in \mathcal{P}}}p$ ;

- $a\left| {v\text{and}b}\right| w$ for all $\left( {v, w}\right) \in \mathcal{V} \times \mathcal{W}$ ;

- if $\left( {v, w}\right) \in \mathcal{E}$ and $p \in \mathcal{P}$, then $p \mid \gcd \left( {v, w}\right)$ precisely when $p \mid \gcd \left( {a, b}\right)$ .

We shall refer to $\left( {\mathcal{P}, a, b}\right)$ as the multiplicative data of $G$ . Furthermore, we defined the edge density of $G$ by $\delta \left( G\right) \mathrel{\text{:=}} \frac{\mu \left( \mathcal{E}\right) }{\mu \left( \mathcal{V}\right) \mu \left( \mathcal{W}\right) }$, and its quality by

$$
q\left( G\right) \mathrel{\text{:=}} \delta {\left( G\right) }^{9} \cdot \mu \left( \mathcal{E}\right) \cdot \frac{ab}{\gcd {\left( a, b\right) }^{2}} \cdot \frac{ab}{\varphi \left( {ab}\right) } \cdot \mathop{\prod }\limits_{{p \in \mathcal{P}}}{\left( 1 - \frac{1}{{p}^{3/2}}\right) }^{-{10}}.
$$

In addition, we define the set of "remaining large primes" of $G$ by

$$
\mathcal{R}\left( G\right) \mathrel{\text{:=}} \left\{ {p \notin \mathcal{P} : p > {5}^{100}, p \mid \gcd \left( {v, w}\right) \text{ for some }\left( {v, w}\right) \in \mathcal{E}}\right\} .
$$

Finally, if ${G}^{\prime } = \left( {{\mathcal{V}}^{\prime },{\mathcal{W}}^{\prime },{\mathcal{E}}^{\prime },{\mathcal{P}}^{\prime },{a}^{\prime },{b}^{\prime }}\right)$ is another square-free GCD graph, we call it a subgraph of $G$ if ${\mathcal{V}}^{\prime } \subseteq \mathcal{V},{\mathcal{W}}^{\prime } \subseteq \mathcal{W},{\mathcal{E}}^{\prime } \subseteq \mathcal{E},{\mathcal{P}}^{\prime } \supseteq \mathcal{P},\mathop{\prod }\limits_{{p \mid {a}^{\prime }, p \in \mathcal{P}}}p = a,\mathop{\prod }\limits_{{p \mid {b}^{\prime }, p \in \mathcal{P}}}p = b$ .

Lemma 3.6 (The quality increment argument). Let $G = \left( {\mathcal{V},\mathcal{W},\mathcal{E},\mathcal{P}, a, b}\right)$ be a square-free GCD graph, let $p \in \mathcal{R}\left( G\right)$, and let $\alpha = \frac{\mu \left( {\{ v \in \mathcal{V} : p \mid v\} }\right) }{\mu \left( \mathcal{V}\right) }$ and $\beta = \frac{\mu \left( {\{ w \in \mathcal{W} : p \mid w\} }\right) }{\mu \left( \mathcal{W}\right) }$ .

(a) If $\min \{ \alpha ,\beta \} \leq 1 - {5}^{12}/p$, then there is a subgraph ${G}^{\prime }$ of $G$ with multiplicative data $\left( {\mathcal{P}\cup \{ p\}, a{p}^{k}, b{p}^{\ell }}\right)$ for some $k,\ell \in \{ 0,1\}$ satisfying $\delta {\left( {G}^{\prime }\right) }^{m}q\left( {G}^{\prime }\right) \geq$ ${2}^{k \neq \ell }\delta {\left( G\right) }^{m}q\left( G\right)$ for $m \in \{ 0,1\} .$

(b) If $\min \{ \alpha ,\beta \} > 1 - {5}^{12}/p$, then there is a subgraph ${G}^{\prime }$ of $G$ with set of primes $\mathcal{P} \cup \{ p\}$ and with quality $q\left( {G}^{\prime }\right) \geq q\left( G\right)$ .

Proof. Each pair of $k,\ell \in \{ 0,1\}$ defines a subgraph of $G$ with multiplicative data $\left( {\mathcal{P}\cup \{ p\}, a{p}^{k}, b{p}^{\ell }}\right)$ . Indeed, we merely need to focus on the vertex subsets ${\mathcal{V}}_{k} = \{ v \in$ $\mathcal{V} : {p}^{k}\parallel v\}$ and ${\mathcal{W}}_{\ell } = \left\{ {w \in \mathcal{W} : {p}^{\ell }\parallel w}\right\}$ . This new GCD graph is formally given by the sextuple ${G}_{k,\ell } = \left( {{\mathcal{V}}_{k},{\mathcal{W}}_{\ell },{\mathcal{E}}_{k,\ell },\mathcal{P}\cup \{ p\}, a{p}^{k}, b{p}^{\ell }}\right)$, where ${\mathcal{E}}_{k,\ell } = \mathcal{E} \cap \left( {{\mathcal{V}}_{k} \times {\mathcal{W}}_{\ell }}\right)$ . Let ${\delta }_{k,\ell } = \frac{\mu \left( {\mathcal{E}}_{k,\ell }\right) }{\mu \left( \mathcal{E}\right) },{\alpha }_{k} = \frac{\mu \left( {\mathcal{V}}_{k}\right) }{\mu \left( \mathcal{V}\right) }$ and ${\beta }_{\ell } = \frac{\mu \left( {\mathcal{W}}_{\ell }\right) }{\mu \left( \mathcal{W}\right) }$, so that ${\alpha }_{0} = 1 - \alpha ,{\alpha }_{1} = \alpha ,{\beta }_{0} = 1 - \beta$ and ${\beta }_{1} = \beta$ . We then have

$$
\frac{\delta {\left( {G}_{k,\ell }\right) }^{m}q\left( {G}_{k,\ell }\right) }{\delta {\left( G\right) }^{m}q\left( G\right) } = \frac{{\delta }_{k,\ell }^{{10} + m}{\left( {\alpha }_{k}{\beta }_{\ell }\right) }^{-9 - m}{p}^{{1}_{k \neq \ell }}}{{\left( 1 - 1/p\right) }^{k + \ell }{\left( 1 - {p}^{-3/2}\right) }^{10}}. \tag{3.10}
$$

(a) We claim that there exist choices of $k,\ell \in \{ 0,1\}$ such that

$$
{\delta }_{k,\ell } \geq \left\{ \begin{array}{ll} {\left( {\alpha }_{k}{\beta }_{k}\right) }^{9/{10}} & \text{ if }k = \ell , \\ \frac{\alpha \left( {1 - \beta }\right) + \left( {1 - \alpha }\right) \beta }{5} & \text{ if }k \neq \ell . \end{array}\right. \tag{3.11}
$$

To prove this claim, it suffices to show that

$$
{\left( \alpha \beta \right) }^{9/{10}} + {\left( \left( 1 - \alpha \right) \left( 1 - \beta \right) \right) }^{9/{10}} + \frac{2}{5} \cdot \left\lbrack {\alpha \left( {1 - \beta }\right) + \left( {1 - \alpha }\right) \beta }\right\rbrack \leq 1. \tag{3.12}
$$

Let $u = \max \{ {\alpha \beta },\left( {1 - \alpha }\right) \left( {1 - \beta }\right) \}$ . Then

$$
{\left( \alpha \beta \right) }^{9/{10}} + {\left( \left( 1 - \alpha \right) \left( 1 - \beta \right) \right) }^{9/{10}} \leq {u}^{2/5}\left\lbrack {{\left( \alpha \beta \right) }^{1/2} + {\left( \left( 1 - \alpha \right) \left( 1 - \beta \right) \right) }^{1/2}}\right\rbrack \leq {u}^{2/5}
$$

by the Cauchy-Schwarz inequality. On the other hand, we have

$$
\alpha \left( {1 - \beta }\right) + \left( {1 - \alpha }\right) \beta = 1 - {\alpha \beta } - \left( {1 - \alpha }\right) \left( {1 - \beta }\right) \leq 1 - u.
$$

In conclusion, the left-hand side of (3.12) is $\leq {u}^{2/5} + 2\left( {1 - u}\right) /5 \leq 1$, as needed.

Now, if (3.11) is true with $k = \ell$, part (a) of the lemma follows immediately by (3.10) upon taking ${G}^{\prime } = {G}_{k, k}$ . Assume then that (3.11) fails when $k = \ell$ . We separate two cases.

Case 1: $\max \{ \alpha ,\beta \} > {5}^{12}/p$ . We know that (3.11) holds for some choice of $k \neq \ell$ . Suppose that $k = 1$ and $\ell = 0$ for the sake of concreteness; the other case is similar. Then,(3.10) implies

$$
\frac{\delta {\left( {G}_{1,0}\right) }^{m}q\left( {G}_{1,0}\right) }{\delta {\left( G\right) }^{m}q\left( G\right) } \geq {\left( \frac{\alpha \left( {1 - \beta }\right) + \beta \left( {1 - \alpha }\right) }{5}\right) }^{{10} + m}\frac{p}{{\left( \alpha \left( 1 - \beta \right) \right) }^{9 + m}}
$$

$$
\geq \frac{\alpha \left( {1 - \beta }\right) + \beta \left( {1 - \alpha }\right) }{{5}^{11}}p
$$

for $m \leq 1$ . The proof is complete by taking ${G}^{\prime } = {G}_{1,0}$, unless $\alpha \left( {1 - \beta }\right) + \beta \left( {1 - \alpha }\right) <$ $2 \cdot {5}^{11}/p$ . In this case, we claim that either $\max \{ \alpha ,\beta \} < {5}^{12}/p$ or $\min \{ \alpha ,\beta \} > 1 - {5}^{12}/p$ (both of which we have assumed are false). By symmetry, we may assume $\alpha \leq 1/2$ . Then $\beta /2 \leq \beta \left( {1 - \alpha }\right) < 2 \cdot {5}^{11}/p$, as needed. In particular, $\beta \leq 1/2$ (because $p > {5}^{100}$ ), and thus $\alpha /2 \leq \alpha \left( {1 - \beta }\right) < 2 \cdot {5}^{11}/p$ . We have thus reached a contradiction. This proves the lemma in this case.

Case 2: $\max \{ \alpha ,\beta \} \leq {5}^{12}/p$ . We must then have ${\delta }_{1,1} \leq {\left( \alpha \beta \right) }^{9/{10}} \leq {5}^{22}{p}^{-9/5}$ . Let us now define the GCD subgraph ${G}^{\prime } = \left( {\mathcal{V},\mathcal{W},{\mathcal{E}}^{\prime },\mathcal{P}\cup \{ p\}, a, b}\right)$, where ${\mathcal{E}}^{\prime } = \mathcal{E} \smallsetminus \left( {{\mathcal{V}}_{1} \times {\mathcal{W}}_{1}}\right)$ . Notice that we trivially have $a\left| {v\text{and}b}\right| w$ . In addition, since we have removed all edges $\left( {v, w}\right)$ where $p$ divides both $v$ and $w$, we must have that $p \nmid \gcd \left( {v, w}\right)$ whenever $\left( {v, w}\right) \in {\mathcal{E}}^{\prime }$ . So, indeed, we see that ${G}^{\prime }$ is a GCD subgraph of $G$ . Moreover,

$$
\frac{\delta {\left( {G}^{\prime }\right) }^{m}q\left( {G}^{\prime }\right) }{\delta {\left( G\right) }^{m}q\left( G\right) } = {\left( \frac{\mu \left( {\mathcal{E}}^{\prime }\right) }{\mu \left( \mathcal{E}\right) }\right) }^{{10} + m}{\left( 1 - {p}^{-3/2}\right) }^{-{10}} = {\left( 1 - {\delta }_{1,1}\right) }^{{10} + m}{\left( 1 - {p}^{-3/2}\right) }^{-{10}} \geq 1
$$

for $m \leq 1$, because ${\delta }_{1,1} \leq {5}^{22}{p}^{-9/5}$ and $p > {5}^{100}$ . This proves the lemma in this case, too. (b) Let $c = {\left( 1 - {p}^{-3/2}\right) }^{-1}$ . Using (3.10), we get a quality increment by letting ${G}^{\prime } = {G}_{k,\ell }$ if one of the following inequalities holds:

$$
c{\delta }_{1,1} \geq {\left( \alpha \beta \right) }^{9/{10}}{\left( 1 - 1/p\right) }^{2/{10}},\;c{\delta }_{0,0} \geq {\left( \left( 1 - \alpha \right) \left( 1 - \beta \right) \right) }^{9/{10}},
$$

$$
c{\delta }_{1,0} \geq {\left( \alpha \left( 1 - \beta \right) \right) }^{9/{10}}{p}^{-1/{10}},\;c{\delta }_{0,1} \geq {\left( \left( 1 - \alpha \right) \beta \right) }^{9/{10}}{p}^{-1/{10}}. \tag{3.13}
$$

Let $\alpha = 1 - A/p$ and $\beta = 1 - B/p$ with $A, B \in \left\lbrack {0,{5}^{12}}\right\rbrack$ . It suffices to show that

$$
c \geq {\left( 1 - \frac{A}{p}\right) }^{\frac{9}{10}}{\left( 1 - \frac{B}{p}\right) }^{\frac{9}{10}}{\left( 1 - \frac{1}{p}\right) }^{\frac{2}{10}} + \frac{{\left( AB\right) }^{\frac{9}{10}}}{{p}^{9/5}} + \frac{{\left( 1 - \frac{A}{p}\right) }^{\frac{9}{10}}{B}^{\frac{9}{10}} + {A}^{\frac{9}{10}}{\left( 1 - \frac{B}{p}\right) }^{\frac{9}{10}}}{p}. \tag{3.14}
$$

Indeed, the right-hand side of (3.14) is

$$
\leq \exp \left( {-\frac{{0.9A} + {0.9B} + {0.2}}{p}}\right) + \frac{{5}^{22}}{{p}^{9/5}} + \frac{{A}^{9/{10}} + {B}^{9/{10}}}{p}
$$

$$
\leq 1 - \frac{0.A + {0.9B} + {0.2}}{p} + \frac{{\left( {0.9}A + {0.9}B + {0.2}\right) }^{2}}{2{p}^{2}} + \frac{{5}^{22}}{{p}^{9/5}} + \frac{{A}^{9/{10}} + {B}^{9/{10}}}{p},
$$

where we used the inequalities $0 \leq 1 - x \leq {e}^{-x} \leq 1 - x + {x}^{2}/2$, valid for all $x \in \left\lbrack {0,1}\right\rbrack$ . By the inequality of arithmetic and geometric means, we have ${0.9A} + {0.1} \geq {A}^{9/{10}}$ and ${0.9B} + {0.1} \geq {B}^{9/{10}}$ . Hence, the right-hand side of (3.14) is

$$
\leq 1 + \frac{{\left( {0.9}A + {0.9}B + {0.2}\right) }^{2}}{2{p}^{2}} + \frac{{5}^{11}}{{p}^{9/5}} \leq 1 + \frac{{5}^{25}}{{p}^{2}} + \frac{{5}^{22}}{{p}^{9/5}} \leq 1 + \frac{1}{{p}^{3/2}} \leq c
$$

for $p > {5}^{100}$ . This completes the proof of the part (b) of the lemma.

## 3.6. Proof of Theorem 3.5

Let $Q, N, S$ and ${\mathcal{B}}_{t}$ with $t \geq {t}_{{j}_{0} + 1}$ be as in Section 3.3. We want to prove (3.6). We may assume that $\mu \left( {\mathcal{B}}_{t}\right) \geq \mu {\left( S\right) }^{2}/t$ ; otherwise,(3.6) is trivially true.

Consider the GCD graph ${G}_{0} \mathrel{\text{:=}} \left( {\mathcal{S},\mathcal{S},{\mathcal{B}}_{t},\varnothing ,\varnothing ,\varnothing }\right)$, and note that $\delta \left( {G}_{0}\right) \geq 1/t$ . We repeatedly apply part (a) of Lemma 3.6 to create a sequence of distinct primes ${p}_{1},{p}_{2},\ldots$ and of square-free GCD graphs ${G}_{j} = \left( {{\mathcal{V}}_{j},{\mathcal{W}}_{j},{\mathcal{E}}_{j},\left\{ {{p}_{1},\ldots ,{p}_{j}}\right\} ,{a}_{j},{b}_{j}}\right), j = 1,2,\ldots$, with ${G}_{j}$ a subgraph of ${G}_{j - 1}$ . Assuming we have applied Lemma 3.6(a) $j$ times, we may apply it once more if there is $p \in \mathcal{R}\left( {G}_{j}\right)$ dividing a proportion $\leq 1 - {5}^{12}/p$ of ${\mathcal{V}}_{j}$ and ${\mathcal{W}}_{j}$ .

Naturally, the above process will terminate after a finite time, say after ${J}_{1}$ steps and we will arrive at a GCD graph ${G}_{{J}_{1}}$ such that if $p \in \mathcal{R}\left( {G}_{{J}_{1}}\right)$, then $p$ divides a proportion $> 1 - {5}^{12}/p$ of the vertex sets ${\mathcal{V}}_{{J}_{1}}$ and ${\mathcal{W}}_{{J}_{1}}$ . In addition, the sequence of GCD graphs produced is such that $\delta {\left( {G}_{j}\right) }^{m}q\left( {G}_{j}\right) \geq {2}^{{1}_{j \in \mathcal{D}}}\delta {\left( {G}_{j - 1}\right) }^{m}q\left( {G}^{\left( j - 1\right) }\right)$ for $m \in \{ 0,1\}$, where

$$
\mathcal{D} = \left\{ {j \leq {J}_{1} : {p}_{j}\text{ divides }{a}_{{J}_{1}}{b}_{{J}_{1}}/\gcd {\left( {a}_{{J}_{1}},{b}_{{J}_{1}}\right) }^{2}}\right\} .
$$

In particular,

$$
\delta {\left( {G}_{{J}_{1}}\right) }^{m}q\left( {G}_{{J}_{1}}\right) \geq {2}^{\# \mathcal{D}}\delta {\left( {G}_{0}\right) }^{m}q\left( {G}_{0}\right) \;\text{ for }m \in \{ 0,1\} . \tag{3.15}
$$

To proceed, we must separate two cases.

Case 1: $q\left( {G}_{{J}_{1}}\right) \geq {t}^{30}q\left( {G}_{0}\right)$ . We apply repeatedly Lemma 3.6 (either part (a) or (b), according to whether the condition $\min \{ \alpha ,\beta \} \leq 1 - {5}^{12}/p$ holds or fails) to create a sequence of primes ${p}_{{J}_{1} + 1},{p}_{{J}_{1} + 2},\ldots$ that are distinct from each other and from ${p}_{1},\ldots ,{p}_{{J}_{1}}$, and of square-free GCD graphs ${G}_{j} = \left( {{\mathcal{V}}_{j},{\mathcal{W}}_{j},{\mathcal{E}}_{j},\left\{ {{p}_{1},\ldots ,{p}_{j}}\right\} ,{a}_{j},{b}_{j}}\right), j = {J}_{1} + j,{J}_{1} + 2,\ldots$ ,

with ${G}_{j}$ a subgraph of ${G}_{j - 1}$ . As before, this process will terminate, say after ${J}_{2} - {J}_{1}$ steps, and we will arrive at a GCD graph ${G}_{{J}_{2}}$ with $\mathcal{R}\left( {G}_{{J}_{2}}\right) = \varnothing$ . By construction, we have

$$
q\left( {G}_{{J}_{2}}\right) \geq q\left( {G}_{{J}_{2} - 1}\right) \geq \cdots \geq q\left( {G}_{{J}_{1}}\right) \geq {t}^{30}q\left( {G}_{0}\right) .
$$

In addition, we have

$$
q\left( {G}_{0}\right) = \frac{\mu {\left( {\mathcal{B}}_{t}\right) }^{10}}{\mu {\left( S\right) }^{18}} \geq \frac{\mu {\left( {\mathcal{B}}_{t}\right) }^{10}}{{N}^{18}} \tag{3.16}
$$

by (3.4). (In particular, note that $q\left( {G}_{0}\right) > 0$, so $q\left( {G}_{{J}_{2}}\right) > 0$ and thus ${\mathcal{E}}_{{J}_{2}} \neq \varnothing$ .) On the other hand, if we let $a = {a}_{{J}_{2}}$ and $b = {b}_{{J}_{2}}$, then $\gcd \left( {v, w}\right) \mid \gcd \left( {a, b}\right) P$ with $P = \mathop{\prod }\limits_{{p \leq {5}^{100}}}p$ for all $\left( {v, w}\right) \in {\mathcal{E}}_{{J}_{2}}$ . In particular, $\gcd \left( {a, b}\right) > Q/\left( {PNt}\right)$ . Moreover,

$$
\mu \left( {\mathcal{E}}_{{J}_{2}}\right) \leq \mathop{\sum }\limits_{{m \leq {2Q}/a, n \leq {2Q}/b}}\frac{\varphi \left( {am}\right) }{am} \cdot \frac{\varphi \left( {bn}\right) }{bn} \leq \frac{\varphi \left( a\right) \varphi \left( b\right) }{ab} \cdot \frac{4{Q}^{2}}{ab}.
$$

Since $\delta \left( {G}_{{J}_{2}}\right) \leq 1$ and $\mathop{\prod }\limits_{p}{\left( 1 - 1/{p}^{3/2}\right) }^{-{10}} < \infty$, we then have

$$
q\left( {G}_{{J}_{2}}\right) \ll \mu \left( {\mathcal{E}}_{{J}_{2}}\right) \frac{ab}{\gcd {\left( a, b\right) }^{2}}\frac{ab}{\varphi \left( a\right) \varphi \left( b\right) } \ll {t}^{2}{N}^{2}. \tag{3.17}
$$

Recalling that $q\left( {G}_{{J}_{2}}\right) \geq {t}^{30}q\left( {G}_{0}\right)$, relations (3.16) and (3.17) complete the proof of (3.6), and thus of Theorem 3.5 in this case.

Case 2: $q\left( {G}_{{J}_{1}}\right) < {t}^{30}q\left( {G}_{0}\right)$ . In this case, we do not have such a big quality gain, so we need to use that ${L}_{t}\left( {v, w}\right) > {100}$ for all $\left( {v, w}\right) \in {\mathcal{B}}_{t}$ . But we must be very careful because this condition might be dominated by the prime divisors of the fixed integers $a$ and $b$ we are constructing. Before we proceed, note that (3.15) implies that

$$
\delta \left( {G}_{{J}_{1}}\right) \geq \delta \left( {G}_{0}\right) \cdot \frac{q\left( {G}_{0}\right) }{q\left( {G}_{{J}_{1}}\right) } \geq \frac{1}{t} \cdot \frac{1}{{t}^{30}} = \frac{1}{{t}^{31}}. \tag{3.18}
$$

Let $\mathcal{R} = \mathcal{R}\left( {J}_{1}\right)$ and let $p \in \mathcal{R}$ . By the construction of ${G}_{{J}_{1}}, p$ divides a proportion $> 1 - {5}^{12}/p$ of the vertex sets ${\mathcal{V}}_{{J}_{1}}$ and ${\mathcal{W}}_{{J}_{1}}$ . Therefore,

$$
\mu \left( \left\{ {\left( {v, w}\right) \in {\mathcal{E}}_{{J}_{1}} : p \mid {vw}/\gcd {\left( v, w\right) }^{2}}\right\} \right) \leq \frac{2 \cdot {5}^{12}}{p}\mu \left( {\mathcal{V}}_{{J}_{1}}\right) \mu \left( {\mathcal{W}}_{{J}_{1}}\right) \leq \frac{{5}^{13}{t}^{31}}{p}\mu \left( {\mathcal{E}}_{{J}_{1}}\right) ,
$$

where we used (3.18). As a consequence, we find

$$
\mathop{\sum }\limits_{{\left( {v, w}\right) \in {\mathcal{E}}_{{J}_{1}}}}\frac{\varphi \left( v\right) \varphi \left( w\right) }{vw}\mathop{\sum }\limits_{\substack{{p > {t}^{32}, p \in \mathcal{R}} \\ {p \mid {vw}/\gcd {\left( v, w\right) }^{2}} }}\frac{1}{p} \leq \mathop{\sum }\limits_{{p > {t}^{32}}}\frac{{5}^{13}{t}^{31}\mu \left( {\mathcal{E}}_{{J}_{1}}\right) }{{p}^{2}} \leq \frac{\mu \left( {\mathcal{E}}_{{J}_{1}}\right) }{100}.
$$

Hence, if we let

$$
{\mathcal{E}}_{{J}_{1}}^{\text{good }} = \left\{ {\left( {v, w}\right) \in {\mathcal{E}}_{{J}_{1}} : \mathop{\sum }\limits_{\substack{{p > {t}^{32}, p \in \mathcal{R}} \\ {p \mid {vw}/\gcd {\left( v, w\right) }^{2}} }}\frac{1}{p} \leq 1}\right\} ,
$$

Markov’s inequality implies that $\mu \left( {\mathcal{E}}_{{J}_{1}}^{\text{good }}\right) \geq {0.99\mu }\left( {\mathcal{E}}_{{J}_{1}}\right)$ . We then define the GCD graph ${G}_{0}^{\prime } = \left( {{\mathcal{V}}_{{J}_{1}},{\mathcal{W}}_{{J}_{1}},{\mathcal{E}}_{{J}_{1}}^{\text{good }},\mathcal{P},{a}_{{J}_{1}},{b}_{{J}_{1}}}\right)$ . Note that

$$
g\left( {G}_{0}^{\prime }\right) = {\left( \frac{\mu \left( {\mathcal{E}}_{{J}_{1}}^{\text{good }}\right) }{\mu \left( {\mathcal{E}}_{{J}_{1}}\right) }\right) }^{10}q\left( {G}_{{J}_{1}}\right) \geq \frac{q\left( {G}_{{J}_{1}}\right) }{2} \geq \frac{q\left( {G}_{0}\right) }{2}.
$$

Next, we apply repeatedly Lemma 3.6 to create a sequence of distinct primes ${p}_{{J}_{1} + 1},{p}_{{J}_{1} + 2},\ldots \in \mathcal{R}$ and of GCD graphs ${G}_{j}^{\prime } = \left( {{\mathcal{V}}_{j}^{\prime },{\mathcal{W}}_{j}^{\prime },{\mathcal{E}}_{j}^{\prime },\left\{ {{p}_{1},\ldots ,{p}_{{J}_{1} + j}}\right\} ,{a}_{j}^{\prime },{b}_{j}^{\prime }}\right)$ , $j = 1,\ldots$, with ${G}_{j}^{\prime }$ a subgraph of ${G}_{j - 1}^{\prime }$ . This process will terminate, say after $K$ steps, and we will arrive at a GCD graph ${G}_{K}^{\prime }$ with $\mathcal{R}\left( {G}_{K}^{\prime }\right) = \varnothing$ . By construction, we have

$$
q\left( {G}_{K}^{\prime }\right) \geq q\left( {G}_{K - 1}^{\prime }\right) \geq \cdots \geq q\left( {G}_{0}^{\prime }\right) \geq q\left( {G}_{0}\right) /2 > 0. \tag{3.19}
$$

In particular, ${\mathcal{E}}_{K}^{\prime } \neq \varnothing$ . It remains to give an upper bound on $q\left( {G}_{K}^{\prime }\right)$ .

Let ${a}^{\prime } = {a}_{K}^{\prime }$ and $b = {b}_{K}^{\prime }$, and recall that $P = \mathop{\prod }\limits_{{p \leq {5}^{100}}}p$ . Then $\gcd \left( {v, w}\right) \mid \gcd \left( {{a}^{\prime },{b}^{\prime }}\right) P$ for all $\left( {v, w}\right) \in {\mathcal{E}}_{K}^{\prime }$ . In particular, $\gcd \left( {{a}^{\prime },{b}^{\prime }}\right) > Q/\left( {PNt}\right)$ . Moreover, if $\left( {v, w}\right) \in {\mathcal{E}}_{K}^{\prime }$ and we let $v = {a}^{\prime }m$ and $w = {b}^{\prime }n$, then

$$
{100} < {L}_{t}\left( {v, w}\right) \leq 5 + {L}_{{t}^{32}}\left( {v, w}\right) \leq 6 + \mathop{\sum }\limits_{\substack{{p > {t}^{32}, p \notin \mathcal{R}} \\ {p \mid {vw}/\gcd {\left( v, w\right) }^{2}} }}\frac{1}{p} \leq 6 + \frac{\# \mathcal{D}}{{t}^{32}} + {L}_{{t}^{32}}\left( {m, n}\right) ,
$$

where the first inequality is true because $\left( {v, w}\right) \in {\mathcal{B}}_{t}$, the second because $\mathop{\sum }\limits_{{y < p \leq {y}^{2}}}1/p \leq 1$ for $y \geq {t}_{{j}_{0}}$, the third because $\left( {v, w}\right) \in {\mathcal{E}}_{{J}_{1}}^{\text{good }}$, and the fourth because if $p$ divides ${a}^{\prime }{b}^{\prime }/\gcd {\left( {a}^{\prime },{b}^{\prime }\right) }^{2}$ and $p \notin \mathcal{R}$, then $p \in \mathcal{D}$ . Now, since ${2}^{\# \mathcal{D}} \leq q\left( {G}_{{J}_{1}}\right) /q\left( {G}_{0}\right) \leq {t}^{30}$, we have that ${L}_{{t}^{32}}\left( {m, n}\right) > {93}$ . Therefore,

$$
\mu \left( {\mathcal{E}}_{K}^{\prime }\right) \leq \mathop{\sum }\limits_{\substack{{m \leq {2Q}/{a}^{\prime }, n \leq {2Q}/{b}^{\prime }} \\ {{L}_{{t}^{32}}\left( {m, n}\right) > {93}} }}\frac{\varphi \left( {a}^{\prime }\right) \varphi \left( {b}^{\prime }\right) }{{a}^{\prime }{b}^{\prime }} \ll \frac{\varphi \left( {a}^{\prime }\right) \varphi \left( {b}^{\prime }\right) }{{a}^{\prime }{b}^{\prime }} \cdot \frac{4{Q}^{2}}{{a}^{\prime }{b}^{\prime }}{e}^{-{t}^{32}},
$$

by arguing as in the proof of (3.7). We may then insert this inequality into the definition of $q\left( {G}_{K}^{\prime }\right)$ and conclude that $q\left( {G}_{K}^{\prime }\right) \ll {e}^{-{t}^{32}}{t}^{2}{N}^{2}$ . Together with (3.19) and (3.16), this completes the proof of (3.6), and thus of Theorem 3.5 in this last case as well.

## ACKNOWLEDGMENTS

The author is grateful to James Maynard for his comments on a preliminary version of the paper.

## FUNDING

The author is supported by the Courtois Chair II in fundamental research of the Univer-sité de Montréal, the Natural Sciences and Engineering Research Council of Canada (Discovery Grant 2018-05699), and the Fonds de recherche du Québec - Nature et technologies (projets de recherche en équipe 256442 and 300951).

## REFERENCES

[1] C. Aistleitner, Decoupling theorems for the Duffin-Schaeffer problem. Progress report, 2019, 24 pp. arXiv:1907.04590.

2 C. Aistleitner, T. Lachmann, M. Munsch, N. Technau, and A. Zafeiropoulos,

The Duffin-Schaeffer conjecture with extra divergence. Adv. Math. 356 (2019), 106808, 11 pp.

[3] V. Beresnevich, G. Harman, A. K. Haynes, and S. Velani, The Duffin-Schaeffer conjecture with extra divergence II. Math. Z. 275 (2013), no. 1-2, 127-133.

[4] V. Beresnevich and S. Velani, A mass transference principle and the Duffin-Schaeffer conjecture for Hausdorff measures. Ann. of Math. (2) 164 (2006), no. 3, 971–992.

[5] A. S. Besicovitch, Sets of fractional dimensions (IV): on rational approximation to real numbers. J. Lond. Math. Soc. 9 (1934), no. 2, 126-131.

[6] J. W. S. Cassels, Some metrical theorems in Diophantine approximation. I. Proc. Camb. Philos. Soc. 46 (1950), 209-218.

[7] P. A. Catlin, Two problems in metric Diophantine approximation. I. J. Number Theory 8 (1976), no. 3, 282-288.

[8] R. J. Duffin and A. C. Schaeffer, Khinchin's problem in metric Diophantine approximation. Duke Math. J. 8 (1941), 243-255.

[9] F. J. Dyson, A theorem on the densities of sets of integers. J. Lond. Math. Soc. 20 (1945), 8-14.

[10] P. Erdős, On the distribution of the convergents of almost all real numbers. J. Number Theory 2 (1970), 425-441.

[11] P. Erdős, C. Ko, and R. Rado, Intersection theorems for systems of finite sets. Quart. J. Math. Oxf. Ser. (2) 12 (1961), 313–320.

[12] P. Gallagher, Approximation by reduced fractions. J. Math. Soc. Japan 13 (1961), 342–345.

[13] B. Green and A. Walker, Extremal problems for GCDs. 2020, arXiv:2012.02078.

[14] G. Harman, Metric number theory. London Math. Soc. Monogr. New Ser. 18, The Clarendon Press, Oxford University Press, New York, 1998.

[15] A. K. Haynes, A. D. Pollington, and S. L. Velani, The Duffin-Schaeffer conjecture with extra divergence. Math. Ann. 353 (2012), no. 2, 259-273.

[16] V. Jarník, Zur metrischen Theorie der diophantischen Approximationen. Proc. Mat. Fiz. 36 (1928), 91–106.

7] A. Khinchin, Continued fractions. Dover Publications, Inc., Mineola, NY, 1997.

[18] A. Khintchine, Einige Sätze über Kettenbrüche, mit Anwendungen auf die

Theorie der Diophantischen Approximationen. Math. Ann. 92 (1924), no. 1-2, 115-125.

[19] D. Koukoulopoulos, The distribution of prime numbers. Grad. Stud. Math. 203, American Mathematical Society, Providence, RI, 2019.

[20] D. Koukoulopoulos and J. Maynard. Ann. of Math. (2) 192 (2020), no. 1, 251-307.

[21] K. Matomäki, The distribution of ${\alpha p}$ modulo one. Math. Proc. Cambridge Philos. Soc. 147 (2009), no. 2, 267-283.

[22] A. D. Pollington and R. C. Vaughan, The $k$ -dimensional Duffin and Schaeffer conjecture. Mathematika 37 (1990), no. 2, 190-200.

[23] K. F. Roth, Sur quelques ensembles d'entiers. C. R. Acad. Sci. Paris 234 (1952), 388-390.

[24] K. F. Roth, On certain sets of integers. J. Lond. Math. Soc. 28 (1953), 104-109.

[25] K. F. Roth, Rational approximations to algebraic numbers. Mathematika 2 (1955), 1-20; corrigendum, 168.

[26] E. M. Stein and R. Shakarchi, Real analysis. Measure theory, integration, and Hilbert spaces. Princeton Lect. Anal. 3, Princeton University Press, Princeton, NJ, 2005.

[27] J. D. Vaaler, On the metric theory of Diophantine approximation. Pacific J. Math. 76 (1978), no. 2, 527–539.

[28] A. Zaharescu, Small values of ${n}^{2}\alpha {\;\operatorname{mod}\;1}$ . Invent. Math. 121 (1995), no. 2, 379-388.

[29] D. Zeilberger and W. Zudilin, The irrationality measure of $\pi$ is at most 7.103205334137... Mosc. J. Comb. Number Theory 9 (2020), no. 4, 407–419.

## DIMITRIS KOUKOULOPOULOS

Département de mathématiques et de statistique, Université de Montréal, CP 6128 succ. Centre-Ville, Montréal, QC H3C 3J7, Canada, dimitris.koukoulopoulos@umontreal.ca
